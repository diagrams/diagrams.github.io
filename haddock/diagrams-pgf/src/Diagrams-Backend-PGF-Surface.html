<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Diagrams/Backend/PGF/Surface.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE TemplateHaskell    #-}</span>
<a name="line-3"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-4"></a><span class='hs-comment'>-- |</span>
<a name="line-5"></a><span class='hs-comment'>-- Module      :  Diagrams.Backend.PGF.Surface</span>
<a name="line-6"></a><span class='hs-comment'>-- Copyright   :  (c) 2015 Christopher Chalmers</span>
<a name="line-7"></a><span class='hs-comment'>-- License     :  BSD-style (see LICENSE)</span>
<a name="line-8"></a><span class='hs-comment'>-- Maintainer  :  diagrams-discuss@googlegroups.com</span>
<a name="line-9"></a><span class='hs-comment'>--</span>
<a name="line-10"></a><span class='hs-comment'>-- A 'Surface' defines how a pgfpicture should be placed and compiled. Surfaces</span>
<a name="line-11"></a><span class='hs-comment'>-- are used for rendering a @.tex@ or @.pdf@ using functions from</span>
<a name="line-12"></a><span class='hs-comment'>-- 'Diagrams.Backend.PGF'.</span>
<a name="line-13"></a><span class='hs-comment'>--</span>
<a name="line-14"></a><span class='hs-comment'>-- Surfaces are also used in 'Diagrams.Backend.PGF.Hbox' for querying</span>
<a name="line-15"></a><span class='hs-comment'>-- envelopes of text.</span>
<a name="line-16"></a><span class='hs-comment'>--</span>
<a name="line-17"></a><span class='hs-comment'>-- Surfaces for Latex, Context and plain Tex are provided and reexported by</span>
<a name="line-18"></a><span class='hs-comment'>-- Diagrams.Backend.PGF. Lenses here allow these to be adjusted as required.</span>
<a name="line-19"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Diagrams</span><span class='hs-varop'>.</span><span class='hs-conid'>Backend</span><span class='hs-varop'>.</span><span class='hs-conid'>PGF</span><span class='hs-varop'>.</span><span class='hs-conid'>Surface</span>
<a name="line-22"></a>  <span class='hs-layout'>(</span> <span class='hs-comment'>-- * Surface definition</span>
<a name="line-23"></a>    <span class='hs-conid'>Surface</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-24"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>TexFormat</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-25"></a>
<a name="line-26"></a>    <span class='hs-comment'>-- * Online rendering with surfaces</span>
<a name="line-27"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>surfOnlineTex</span>
<a name="line-28"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>surfOnlineTexIO</span>
<a name="line-29"></a>
<a name="line-30"></a>    <span class='hs-comment'>-- * Predefined surfaces</span>
<a name="line-31"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>latexSurface</span>
<a name="line-32"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>contextSurface</span>
<a name="line-33"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>plaintexSurface</span>
<a name="line-34"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>sampleSurfaceOutput</span>
<a name="line-35"></a>
<a name="line-36"></a>    <span class='hs-comment'>-- * Lenses</span>
<a name="line-37"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>texFormat</span>
<a name="line-38"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>command</span>
<a name="line-39"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>arguments</span>
<a name="line-40"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>pageSize</span>
<a name="line-41"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>preamble</span>
<a name="line-42"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>beginDoc</span>
<a name="line-43"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>endDoc</span>
<a name="line-44"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-45"></a>
<a name="line-46"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Builder</span>
<a name="line-47"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Hashable</span>           <span class='hs-layout'>(</span><span class='hs-conid'>Hashable</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-48"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Typeable</span>           <span class='hs-layout'>(</span><span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-49"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>IO</span><span class='hs-varop'>.</span><span class='hs-conid'>Unsafe</span>
<a name="line-50"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Texrunner</span><span class='hs-varop'>.</span><span class='hs-conid'>Online</span>
<a name="line-51"></a>
<a name="line-52"></a>
<a name="line-53"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Diagrams</span><span class='hs-varop'>.</span><span class='hs-conid'>Prelude</span>
<a name="line-54"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Prelude</span>
<a name="line-55"></a>
<a name="line-56"></a><a name="TexFormat"></a><span class='hs-comment'>-- | The 'TexFormat' is used to choose the different PGF commands nessesary for</span>
<a name="line-57"></a><a name="TexFormat"></a><span class='hs-comment'>--   that format.</span>
<a name="line-58"></a><a name="TexFormat"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TexFormat</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LaTeX</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ConTeXt</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PlainTeX</span>
<a name="line-59"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-60"></a>  <span class='hs-comment'>-- These names are only captialised so Context doesn't conflict with</span>
<a name="line-61"></a>  <span class='hs-comment'>-- lens's Context.</span>
<a name="line-62"></a>
<a name="line-63"></a><a name="Surface"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Surface</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Surface</span>
<a name="line-64"></a>  <span class='hs-layout'>{</span> <span class='hs-sel'>_texFormat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TexFormat</span> <span class='hs-comment'>-- ^ Format for the PGF commands</span>
<a name="line-65"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_command</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>    <span class='hs-comment'>-- ^ System command to be called.</span>
<a name="line-66"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_arguments</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- ^ Auguments for command.</span>
<a name="line-67"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_pageSize</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>V2</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span><span class='hs-layout'>)</span>
<a name="line-68"></a>                            <span class='hs-comment'>-- ^ Command to change page size from dimensions of image.</span>
<a name="line-69"></a>                            <span class='hs-comment'>--   (in bp)</span>
<a name="line-70"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_preamble</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>    <span class='hs-comment'>-- ^ Preamble for document, should import pgfcore.</span>
<a name="line-71"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_beginDoc</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>    <span class='hs-comment'>-- ^ Begin document.</span>
<a name="line-72"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_endDoc</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>    <span class='hs-comment'>-- ^ End document.</span>
<a name="line-73"></a>  <span class='hs-layout'>}</span>
<a name="line-74"></a>
<a name="line-75"></a><a name="makeLensesWith"></a><span class='hs-definition'>makeLensesWith</span> <span class='hs-layout'>(</span><span class='hs-varid'>lensRules</span> <span class='hs-varop'>&amp;</span> <span class='hs-varid'>generateSignatures</span> <span class='hs-varop'>.~</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span> <span class='hs-chr'>'</span><span class='hs-chr'>'</span><span class='hs-conid'>Surface</span>
<a name="line-76"></a>
<a name="line-77"></a><a name="texFormat"></a><span class='hs-comment'>-- | Format for the PGF commands.</span>
<a name="line-78"></a><span class='hs-definition'>texFormat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lens'</span> <span class='hs-conid'>Surface</span> <span class='hs-conid'>TexFormat</span>
<a name="line-79"></a>
<a name="line-80"></a><a name="command"></a><span class='hs-comment'>-- | System command to call for rendering PDFs for 'OnlineTex'.</span>
<a name="line-81"></a><span class='hs-definition'>command</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lens'</span> <span class='hs-conid'>Surface</span> <span class='hs-conid'>String</span>
<a name="line-82"></a>
<a name="line-83"></a><a name="arguments"></a><span class='hs-comment'>-- | List of arguments for the 'command'.</span>
<a name="line-84"></a><span class='hs-definition'>arguments</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lens'</span> <span class='hs-conid'>Surface</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span>
<a name="line-85"></a>
<a name="line-86"></a><a name="preamble"></a><span class='hs-comment'>-- | Preamble for the tex document. This should at least import</span>
<a name="line-87"></a><span class='hs-comment'>--   @pgfcore@.</span>
<a name="line-88"></a><span class='hs-definition'>preamble</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lens'</span> <span class='hs-conid'>Surface</span> <span class='hs-conid'>String</span>
<a name="line-89"></a>
<a name="line-90"></a><a name="pageSize"></a><span class='hs-comment'>-- | Specify the page size for the tex file.</span>
<a name="line-91"></a><span class='hs-definition'>pageSize</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lens'</span> <span class='hs-conid'>Surface</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>V2</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-92"></a>
<a name="line-93"></a><a name="beginDoc"></a><span class='hs-comment'>-- | Command to begin the document. (This normally doesn't need to</span>
<a name="line-94"></a><span class='hs-comment'>--   change)</span>
<a name="line-95"></a><span class='hs-definition'>beginDoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lens'</span> <span class='hs-conid'>Surface</span> <span class='hs-conid'>String</span>
<a name="line-96"></a>
<a name="line-97"></a><a name="endDoc"></a><span class='hs-comment'>-- | Command to end the document. (This normally doesn't need to</span>
<a name="line-98"></a><span class='hs-comment'>--   change)</span>
<a name="line-99"></a><span class='hs-definition'>endDoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lens'</span> <span class='hs-conid'>Surface</span> <span class='hs-conid'>String</span>
<a name="line-100"></a>
<a name="line-101"></a><span class='hs-comment'>-- Predefined surfaces -------------------------------------------------</span>
<a name="line-102"></a>
<a name="line-103"></a><a name="latexSurface"></a><span class='hs-comment'>-- | Default surface for latex files by calling @pdflatex@.</span>
<a name="line-104"></a><span class='hs-comment'>--</span>
<a name="line-105"></a><span class='hs-comment'>-- ==== __Sample output__</span>
<a name="line-106"></a><span class='hs-comment'>--</span>
<a name="line-107"></a><span class='hs-comment'>-- @</span>
<a name="line-108"></a><span class='hs-comment'>-- 'command': pdflatex</span>
<a name="line-109"></a><span class='hs-comment'>--</span>
<a name="line-110"></a><span class='hs-comment'>-- % 'preamble'</span>
<a name="line-111"></a><span class='hs-comment'>-- \documentclass{article}</span>
<a name="line-112"></a><span class='hs-comment'>-- \usepackage{pgfcore}</span>
<a name="line-113"></a><span class='hs-comment'>-- \pagenumbering{gobble}</span>
<a name="line-114"></a><span class='hs-comment'>--</span>
<a name="line-115"></a><span class='hs-comment'>-- % 'pageSize'</span>
<a name="line-116"></a><span class='hs-comment'>-- \pdfpagewidth=100bp</span>
<a name="line-117"></a><span class='hs-comment'>-- \pdfpageheight=80bp</span>
<a name="line-118"></a><span class='hs-comment'>-- \textheight=80bp</span>
<a name="line-119"></a><span class='hs-comment'>-- \pdfhorigin=-76.6bp</span>
<a name="line-120"></a><span class='hs-comment'>-- \pdfvorigin=-52.8bp</span>
<a name="line-121"></a><span class='hs-comment'>--</span>
<a name="line-122"></a><span class='hs-comment'>-- % 'beginDoc'</span>
<a name="line-123"></a><span class='hs-comment'>-- \begin{document}</span>
<a name="line-124"></a><span class='hs-comment'>--</span>
<a name="line-125"></a><span class='hs-comment'>-- \&lt;Latex pgf code\&gt;</span>
<a name="line-126"></a><span class='hs-comment'>--</span>
<a name="line-127"></a><span class='hs-comment'>-- % 'endDoc'</span>
<a name="line-128"></a><span class='hs-comment'>-- \end{document}</span>
<a name="line-129"></a><span class='hs-comment'>-- @</span>
<a name="line-130"></a><span class='hs-comment'>--</span>
<a name="line-131"></a><span class='hs-definition'>latexSurface</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Surface</span>
<a name="line-132"></a><span class='hs-definition'>latexSurface</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Surface</span>
<a name="line-133"></a>  <span class='hs-layout'>{</span> <span class='hs-sel'>_texFormat</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LaTeX</span>
<a name="line-134"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_command</span>   <span class='hs-keyglyph'>=</span> <span class='hs-str'>"pdflatex"</span>
<a name="line-135"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_arguments</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-136"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_pageSize</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>V2</span> <span class='hs-varid'>w</span> <span class='hs-varid'>h</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-137"></a>                 <span class='hs-str'>"\\pdfpagewidth="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>w</span> <span class='hs-varop'>++</span> <span class='hs-str'>"bp\n"</span>
<a name="line-138"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\pdfpageheight="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>h</span> <span class='hs-varop'>++</span> <span class='hs-str'>"bp\n"</span>
<a name="line-139"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\textheight="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>h</span> <span class='hs-varop'>++</span> <span class='hs-str'>"bp\n"</span>
<a name="line-140"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\pdfhorigin=-76.6bp\n"</span>
<a name="line-141"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\pdfvorigin=-52.8bp"</span>
<a name="line-142"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_preamble</span>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>"\\documentclass{article}\n"</span>
<a name="line-143"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\usepackage{pgfcore}\n"</span>
<a name="line-144"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\pagenumbering{gobble}"</span>
<a name="line-145"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_beginDoc</span>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>"\\begin{document}"</span>
<a name="line-146"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_endDoc</span>    <span class='hs-keyglyph'>=</span> <span class='hs-str'>"\\end{document}"</span>
<a name="line-147"></a>  <span class='hs-layout'>}</span>
<a name="line-148"></a>
<a name="line-149"></a><a name="contextSurface"></a><span class='hs-comment'>-- | Default surface for latex files by calling @pdflatex@.</span>
<a name="line-150"></a><span class='hs-comment'>--</span>
<a name="line-151"></a><span class='hs-comment'>-- ==== __Sample output__</span>
<a name="line-152"></a><span class='hs-comment'>--</span>
<a name="line-153"></a><span class='hs-comment'>-- @</span>
<a name="line-154"></a><span class='hs-comment'>-- 'command': context --pipe --once</span>
<a name="line-155"></a><span class='hs-comment'>--</span>
<a name="line-156"></a><span class='hs-comment'>-- % 'preamble'</span>
<a name="line-157"></a><span class='hs-comment'>-- \usemodule[pgf]</span>
<a name="line-158"></a><span class='hs-comment'>-- \setuppagenumbering[location=]</span>
<a name="line-159"></a><span class='hs-comment'>--</span>
<a name="line-160"></a><span class='hs-comment'>-- % 'pageSize'</span>
<a name="line-161"></a><span class='hs-comment'>-- \definepapersize[diagram][width=100bp,height=80bp]</span>
<a name="line-162"></a><span class='hs-comment'>-- \setuppapersize[diagram][diagram]</span>
<a name="line-163"></a><span class='hs-comment'>-- \setuplayout</span>
<a name="line-164"></a><span class='hs-comment'>--   [ topspace=0bp</span>
<a name="line-165"></a><span class='hs-comment'>--   , backspace=0bp</span>
<a name="line-166"></a><span class='hs-comment'>--   , header=0bp</span>
<a name="line-167"></a><span class='hs-comment'>--   , footer=0bp</span>
<a name="line-168"></a><span class='hs-comment'>--   , width=100bp</span>
<a name="line-169"></a><span class='hs-comment'>--   , height=80bp</span>
<a name="line-170"></a><span class='hs-comment'>--   ]</span>
<a name="line-171"></a><span class='hs-comment'>--</span>
<a name="line-172"></a><span class='hs-comment'>-- % 'beginDoc'</span>
<a name="line-173"></a><span class='hs-comment'>-- \starttext</span>
<a name="line-174"></a><span class='hs-comment'>--</span>
<a name="line-175"></a><span class='hs-comment'>-- \&lt;Context pgf code\&gt;</span>
<a name="line-176"></a><span class='hs-comment'>--</span>
<a name="line-177"></a><span class='hs-comment'>-- % 'endDoc'</span>
<a name="line-178"></a><span class='hs-comment'>-- \stoptext</span>
<a name="line-179"></a><span class='hs-comment'>-- @</span>
<a name="line-180"></a><span class='hs-comment'>--</span>
<a name="line-181"></a><span class='hs-definition'>contextSurface</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Surface</span>
<a name="line-182"></a><span class='hs-definition'>contextSurface</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Surface</span>
<a name="line-183"></a>  <span class='hs-layout'>{</span> <span class='hs-sel'>_texFormat</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ConTeXt</span>
<a name="line-184"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_command</span>   <span class='hs-keyglyph'>=</span> <span class='hs-str'>"context"</span>
<a name="line-185"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_arguments</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"--pipe"</span><span class='hs-layout'>,</span> <span class='hs-str'>"--once"</span><span class='hs-keyglyph'>]</span>
<a name="line-186"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_pageSize</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>V2</span> <span class='hs-varid'>w</span> <span class='hs-varid'>h</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-187"></a>                 <span class='hs-str'>"\\definepapersize[diagram][width="</span><span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>w</span> <span class='hs-varop'>++</span><span class='hs-str'>"bp,height="</span><span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>h</span> <span class='hs-varop'>++</span><span class='hs-str'>"bp]\n"</span>
<a name="line-188"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\setuppapersize[diagram][diagram]\n"</span>
<a name="line-189"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\setuplayout\n"</span>
<a name="line-190"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"  [ topspace=0bp\n"</span>
<a name="line-191"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"  , backspace=0bp\n"</span>
<a name="line-192"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"  , header=0bp\n"</span>
<a name="line-193"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"  , footer=0bp\n"</span>
<a name="line-194"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"  , width="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>w</span> <span class='hs-varop'>++</span> <span class='hs-str'>"bp\n"</span>
<a name="line-195"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"  , height="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>h</span> <span class='hs-varop'>++</span> <span class='hs-str'>"bp\n"</span>
<a name="line-196"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"  ]"</span>
<a name="line-197"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_preamble</span>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>"\\usemodule[pgf]\n"</span> <span class='hs-comment'>-- pgfcore doesn't work</span>
<a name="line-198"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\setuppagenumbering[location=]"</span>
<a name="line-199"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_beginDoc</span>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>"\\starttext"</span>
<a name="line-200"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_endDoc</span>    <span class='hs-keyglyph'>=</span> <span class='hs-str'>"\\stoptext"</span>
<a name="line-201"></a>  <span class='hs-layout'>}</span>
<a name="line-202"></a>
<a name="line-203"></a><a name="plaintexSurface"></a><span class='hs-comment'>-- | Default surface for latex files by calling @pdflatex@.</span>
<a name="line-204"></a><span class='hs-comment'>--</span>
<a name="line-205"></a><span class='hs-comment'>-- ==== __Sample output__</span>
<a name="line-206"></a><span class='hs-comment'>--</span>
<a name="line-207"></a><span class='hs-comment'>-- @</span>
<a name="line-208"></a><span class='hs-comment'>-- 'command': pdftex</span>
<a name="line-209"></a><span class='hs-comment'>--</span>
<a name="line-210"></a><span class='hs-comment'>-- % 'preamble'</span>
<a name="line-211"></a><span class='hs-comment'>-- \input eplain</span>
<a name="line-212"></a><span class='hs-comment'>-- \beginpackages</span>
<a name="line-213"></a><span class='hs-comment'>-- \usepackage{color}</span>
<a name="line-214"></a><span class='hs-comment'>-- \endpackages</span>
<a name="line-215"></a><span class='hs-comment'>-- \input pgfcore</span>
<a name="line-216"></a><span class='hs-comment'>-- \def\frac#1#2{{\begingroup #1\endgroup\over #2}}\nopagenumbers</span>
<a name="line-217"></a><span class='hs-comment'>--</span>
<a name="line-218"></a><span class='hs-comment'>-- % 'pageSize'</span>
<a name="line-219"></a><span class='hs-comment'>-- \pdfpagewidth=100bp</span>
<a name="line-220"></a><span class='hs-comment'>-- \pdfpageheight=80bp</span>
<a name="line-221"></a><span class='hs-comment'>-- \pdfhorigin=-20bp</span>
<a name="line-222"></a><span class='hs-comment'>-- \pdfvorigin=0bp</span>
<a name="line-223"></a><span class='hs-comment'>--</span>
<a name="line-224"></a><span class='hs-comment'>-- % 'beginDoc'</span>
<a name="line-225"></a><span class='hs-comment'>--</span>
<a name="line-226"></a><span class='hs-comment'>--</span>
<a name="line-227"></a><span class='hs-comment'>-- &lt;PlainTex pgf code&gt;</span>
<a name="line-228"></a><span class='hs-comment'>--</span>
<a name="line-229"></a><span class='hs-comment'>-- % 'endDoc'</span>
<a name="line-230"></a><span class='hs-comment'>-- \bye</span>
<a name="line-231"></a><span class='hs-comment'>-- @</span>
<a name="line-232"></a><span class='hs-comment'>--</span>
<a name="line-233"></a><span class='hs-definition'>plaintexSurface</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Surface</span>
<a name="line-234"></a><span class='hs-definition'>plaintexSurface</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Surface</span>
<a name="line-235"></a>  <span class='hs-layout'>{</span> <span class='hs-sel'>_texFormat</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PlainTeX</span>
<a name="line-236"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_command</span>   <span class='hs-keyglyph'>=</span> <span class='hs-str'>"pdftex"</span>
<a name="line-237"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_arguments</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-238"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_pageSize</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-conid'>V2</span> <span class='hs-varid'>w</span> <span class='hs-varid'>h</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-239"></a>                 <span class='hs-str'>"\\pdfpagewidth="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>w</span> <span class='hs-varop'>++</span> <span class='hs-str'>"bp\n"</span>
<a name="line-240"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\pdfpageheight="</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>h</span> <span class='hs-varop'>++</span> <span class='hs-str'>"bp\n"</span>
<a name="line-241"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\pdfhorigin=-20bp\n"</span>
<a name="line-242"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\pdfvorigin=0bp"</span>
<a name="line-243"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_preamble</span>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>"\\input eplain\n"</span>
<a name="line-244"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\beginpackages\n\\usepackage{color}\n\\endpackages\n"</span>
<a name="line-245"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\input pgfcore\n"</span>
<a name="line-246"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\def\\frac#1#2{{\\begingroup #1\\endgroup\\over #2}}"</span>
<a name="line-247"></a>              <span class='hs-varop'>++</span> <span class='hs-str'>"\\nopagenumbers"</span>
<a name="line-248"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_beginDoc</span>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>""</span>
<a name="line-249"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_endDoc</span>    <span class='hs-keyglyph'>=</span> <span class='hs-str'>"\\bye"</span>
<a name="line-250"></a>  <span class='hs-layout'>}</span>
<a name="line-251"></a>
<a name="line-252"></a><a name="instance%20Default%20Surface"></a><span class='hs-comment'>-- | Latex is the default surface.</span>
<a name="line-253"></a><a name="instance%20Default%20Surface"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Default</span> <span class='hs-conid'>Surface</span> <span class='hs-keyword'>where</span>
<a name="line-254"></a>  <span class='hs-varid'>def</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>latexSurface</span>
<a name="line-255"></a>
<a name="line-256"></a><a name="sampleSurfaceOutput"></a><span class='hs-definition'>sampleSurfaceOutput</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Surface</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-257"></a><span class='hs-definition'>sampleSurfaceOutput</span> <span class='hs-varid'>surf</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unlines</span>
<a name="line-258"></a>  <span class='hs-keyglyph'>[</span> <span class='hs-str'>"command: "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>surf</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>command</span> <span class='hs-varop'>++</span> <span class='hs-str'>" "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>unwords</span> <span class='hs-layout'>(</span><span class='hs-varid'>surf</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>arguments</span><span class='hs-layout'>)</span>
<a name="line-259"></a>  <span class='hs-layout'>,</span> <span class='hs-str'>"\n% preamble"</span>
<a name="line-260"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>surf</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>preamble</span>
<a name="line-261"></a>  <span class='hs-layout'>,</span> <span class='hs-str'>"\n% pageSize"</span>
<a name="line-262"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>view</span> <span class='hs-sel'>_Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>surf</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>pageSize</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>V2</span> <span class='hs-num'>100</span> <span class='hs-num'>80</span><span class='hs-layout'>)</span>
<a name="line-263"></a>  <span class='hs-layout'>,</span> <span class='hs-str'>"\n% beginDoc"</span>
<a name="line-264"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>surf</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>beginDoc</span>
<a name="line-265"></a>  <span class='hs-layout'>,</span> <span class='hs-str'>"\n&lt;"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>surf</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>texFormat</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span> <span class='hs-str'>" pgf code&gt;"</span>
<a name="line-266"></a>  <span class='hs-layout'>,</span> <span class='hs-str'>"\n% endDoc"</span>
<a name="line-267"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>surf</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>endDoc</span>
<a name="line-268"></a>  <span class='hs-keyglyph'>]</span>
<a name="line-269"></a>
<a name="line-270"></a><span class='hs-comment'>-- OnlineTex functions -------------------------------------------------</span>
<a name="line-271"></a>
<a name="line-272"></a><a name="surfOnlineTex"></a><span class='hs-comment'>-- | Get the result of an OnlineTex using the given surface.</span>
<a name="line-273"></a><span class='hs-definition'>surfOnlineTex</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Surface</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OnlineTex</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-274"></a><span class='hs-definition'>surfOnlineTex</span> <span class='hs-varid'>surf</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafePerformIO</span> <span class='hs-layout'>(</span><span class='hs-varid'>surfOnlineTexIO</span> <span class='hs-varid'>surf</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-275"></a><span class='hs-comment'>{-# NOINLINE surfOnlineTex #-}</span>
<a name="line-276"></a>
<a name="line-277"></a><a name="surfOnlineTexIO"></a><span class='hs-comment'>-- | Get the result of an OnlineTex using the given surface.</span>
<a name="line-278"></a><span class='hs-definition'>surfOnlineTexIO</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Surface</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OnlineTex</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span>
<a name="line-279"></a><span class='hs-definition'>surfOnlineTexIO</span> <span class='hs-varid'>surf</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runOnlineTex</span> <span class='hs-layout'>(</span><span class='hs-varid'>surf</span><span class='hs-varop'>^.</span><span class='hs-varid'>command</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>surf</span><span class='hs-varop'>^.</span><span class='hs-varid'>arguments</span><span class='hs-layout'>)</span> <span class='hs-varid'>begin</span>
<a name="line-280"></a>  <span class='hs-keyword'>where</span>
<a name="line-281"></a>    <span class='hs-varid'>begin</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>view</span> <span class='hs-varid'>strict</span> <span class='hs-varop'>.</span> <span class='hs-varid'>toLazyByteString</span> <span class='hs-varop'>.</span> <span class='hs-varid'>stringUtf8</span>
<a name="line-282"></a>          <span class='hs-varop'>$</span> <span class='hs-varid'>surf</span> <span class='hs-varop'>^.</span> <span class='hs-layout'>(</span><span class='hs-varid'>preamble</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>beginDoc</span><span class='hs-layout'>)</span>
<a name="line-283"></a>
<a name="line-284"></a><span class='hs-comment'>-- Hashable instances --------------------------------------------------</span>
<a name="line-285"></a>
<a name="line-286"></a><a name="instance%20Hashable%20TexFormat"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Hashable</span> <span class='hs-conid'>TexFormat</span> <span class='hs-keyword'>where</span>
<a name="line-287"></a>  <span class='hs-varid'>hashWithSalt</span> <span class='hs-varid'>s</span> <span class='hs-conid'>LaTeX</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span> <span class='hs-varop'>`hashWithSalt`</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-288"></a>  <span class='hs-varid'>hashWithSalt</span> <span class='hs-varid'>s</span> <span class='hs-conid'>ConTeXt</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span> <span class='hs-varop'>`hashWithSalt`</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-289"></a>  <span class='hs-varid'>hashWithSalt</span> <span class='hs-varid'>s</span> <span class='hs-conid'>PlainTeX</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span> <span class='hs-varop'>`hashWithSalt`</span> <span class='hs-layout'>(</span><span class='hs-num'>3</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-290"></a>
<a name="line-291"></a><a name="instance%20Hashable%20Surface"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Hashable</span> <span class='hs-conid'>Surface</span> <span class='hs-keyword'>where</span>
<a name="line-292"></a>  <span class='hs-varid'>hashWithSalt</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-conid'>Surface</span> <span class='hs-varid'>tf</span> <span class='hs-varid'>cm</span> <span class='hs-varid'>ar</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>p</span> <span class='hs-varid'>bd</span> <span class='hs-varid'>ed</span><span class='hs-layout'>)</span>
<a name="line-293"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span>                    <span class='hs-varop'>`hashWithSalt`</span>
<a name="line-294"></a>      <span class='hs-varid'>tf</span>                   <span class='hs-varop'>`hashWithSalt`</span>
<a name="line-295"></a>      <span class='hs-varid'>cm</span>                   <span class='hs-varop'>`hashWithSalt`</span>
<a name="line-296"></a>      <span class='hs-varid'>ar</span>                   <span class='hs-varop'>`hashWithSalt`</span>
<a name="line-297"></a>      <span class='hs-varid'>ps</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-conid'>V2</span> <span class='hs-num'>1</span> <span class='hs-num'>2</span><span class='hs-layout'>)</span> <span class='hs-varop'>`hashWithSalt`</span>
<a name="line-298"></a>      <span class='hs-varid'>p</span>                    <span class='hs-varop'>`hashWithSalt`</span>
<a name="line-299"></a>      <span class='hs-varid'>bd</span>                   <span class='hs-varop'>`hashWithSalt`</span>
<a name="line-300"></a>      <span class='hs-varid'>ed</span>
<a name="line-301"></a>
</pre></body>
</html>
