<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Data/Active.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP                        #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE DeriveFunctor              #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts           #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE FlexibleInstances          #-}</span>
<a name="line-5"></a><span class='hs-comment'>{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span>
<a name="line-6"></a><span class='hs-comment'>{-# LANGUAGE MultiParamTypeClasses      #-}</span>
<a name="line-7"></a><span class='hs-comment'>{-# LANGUAGE ScopedTypeVariables        #-}</span>
<a name="line-8"></a><span class='hs-comment'>{-# LANGUAGE TemplateHaskell            #-}</span>
<a name="line-9"></a><span class='hs-comment'>{-# LANGUAGE TypeFamilies               #-}</span>
<a name="line-10"></a><span class='hs-comment'>{-# LANGUAGE TypeSynonymInstances       #-}</span>
<a name="line-11"></a><span class='hs-comment'>{-# LANGUAGE UndecidableInstances       #-}</span>
<a name="line-12"></a><span class='hs-comment'>{-# LANGUAGE ViewPatterns               #-}</span>
<a name="line-13"></a><span class='hs-comment'>-- UndecidableInstances needed for ghc &lt; 707</span>
<a name="line-14"></a><span class='hs-comment'>{-# OPTIONS_GHC -fno-warn-orphans #-}</span>
<a name="line-15"></a>
<a name="line-16"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-17"></a><span class='hs-comment'>-- |</span>
<a name="line-18"></a><span class='hs-comment'>-- Module      :  Data.Active</span>
<a name="line-19"></a><span class='hs-comment'>-- Copyright   :  (c) 2011 Brent Yorgey</span>
<a name="line-20"></a><span class='hs-comment'>-- License     :  BSD-style (see LICENSE)</span>
<a name="line-21"></a><span class='hs-comment'>-- Maintainer  :  byorgey@cis.upenn.edu</span>
<a name="line-22"></a><span class='hs-comment'>--</span>
<a name="line-23"></a><span class='hs-comment'>-- Inspired by the work of Kevin Matlage and Andy Gill (/Every/</span>
<a name="line-24"></a><span class='hs-comment'>-- /Animation Should Have a Beginning, a Middle, and an End/, Trends</span>
<a name="line-25"></a><span class='hs-comment'>-- in Functional Programming,</span>
<a name="line-26"></a><span class='hs-comment'>-- 2010. &lt;<a href="http://ku-fpg.github.io/files/Matlage-10-BeginningMiddleEnd.pdf">http://ku-fpg.github.io/files/Matlage-10-BeginningMiddleEnd.pdf</a>&gt;), this module defines a</span>
<a name="line-27"></a><span class='hs-comment'>-- simple abstraction for working with time-varying values.  A value</span>
<a name="line-28"></a><span class='hs-comment'>-- of type @Active a@ is either a constant value of type @a@, or a</span>
<a name="line-29"></a><span class='hs-comment'>-- time-varying value of type @a@ (/i.e./ a function from time to</span>
<a name="line-30"></a><span class='hs-comment'>-- @a@) with specific start and end times.  Since active values</span>
<a name="line-31"></a><span class='hs-comment'>-- have start and end times, they can be aligned, sequenced,</span>
<a name="line-32"></a><span class='hs-comment'>-- stretched, or reversed.</span>
<a name="line-33"></a><span class='hs-comment'>--</span>
<a name="line-34"></a><span class='hs-comment'>-- In a sense, this is sort of like a stripped-down version of</span>
<a name="line-35"></a><span class='hs-comment'>-- functional reactive programming (FRP), without the reactivity.</span>
<a name="line-36"></a><span class='hs-comment'>--</span>
<a name="line-37"></a><span class='hs-comment'>-- The original motivating use for this library is to support making</span>
<a name="line-38"></a><span class='hs-comment'>-- animations with the diagrams framework</span>
<a name="line-39"></a><span class='hs-comment'>-- (&lt;<a href="http://projects.haskell.org/diagrams">http://projects.haskell.org/diagrams</a>&gt;), but the hope is that it</span>
<a name="line-40"></a><span class='hs-comment'>-- may find more general utility.</span>
<a name="line-41"></a><span class='hs-comment'>--</span>
<a name="line-42"></a><span class='hs-comment'>-- There are two basic ways to create an @Active@ value.  The first is</span>
<a name="line-43"></a><span class='hs-comment'>-- to use 'mkActive' to create one directly, by specifying a start and</span>
<a name="line-44"></a><span class='hs-comment'>-- end time and a function of time.  More indirectly, one can use the</span>
<a name="line-45"></a><span class='hs-comment'>-- 'Applicative' instance together with the unit interval 'ui', which</span>
<a name="line-46"></a><span class='hs-comment'>-- takes on values from the unit interval from time 0 to time 1, or</span>
<a name="line-47"></a><span class='hs-comment'>-- 'interval', which creates an active over an arbitrary interval.</span>
<a name="line-48"></a><span class='hs-comment'>--</span>
<a name="line-49"></a><span class='hs-comment'>-- For example, to create a value of type @Active Double@ which</span>
<a name="line-50"></a><span class='hs-comment'>-- represents one period of a sine wave starting at time 0 and ending</span>
<a name="line-51"></a><span class='hs-comment'>-- at time 1, we could write</span>
<a name="line-52"></a><span class='hs-comment'>--</span>
<a name="line-53"></a><span class='hs-comment'>-- &gt; mkActive 0 1 (\t -&gt; sin (fromTime t * tau))</span>
<a name="line-54"></a><span class='hs-comment'>--</span>
<a name="line-55"></a><span class='hs-comment'>-- or</span>
<a name="line-56"></a><span class='hs-comment'>--</span>
<a name="line-57"></a><span class='hs-comment'>-- &gt; (sin . (*tau)) &lt;$&gt; ui</span>
<a name="line-58"></a><span class='hs-comment'>--</span>
<a name="line-59"></a><span class='hs-comment'>-- 'pure' can also be used to create @Active@ values which are</span>
<a name="line-60"></a><span class='hs-comment'>-- constant and have no start or end time.  For example,</span>
<a name="line-61"></a><span class='hs-comment'>--</span>
<a name="line-62"></a><span class='hs-comment'>-- &gt; mod &lt;$&gt; (floor &lt;$&gt; interval 0 100) &lt;*&gt; pure 7</span>
<a name="line-63"></a><span class='hs-comment'>--</span>
<a name="line-64"></a><span class='hs-comment'>-- cycles repeatedly through the numbers 0-6.</span>
<a name="line-65"></a><span class='hs-comment'>--</span>
<a name="line-66"></a><span class='hs-comment'>-- Note that the \"idiom bracket\" notation supported by the SHE</span>
<a name="line-67"></a><span class='hs-comment'>-- preprocessor (&lt;<a href="http://personal.cis.strath.ac.uk/~conor/pub/she/">http://personal.cis.strath.ac.uk/~conor/pub/she/</a>&gt;,</span>
<a name="line-68"></a><span class='hs-comment'>-- &lt;<a href="http://hackage.haskell.org/package/she">http://hackage.haskell.org/package/she</a>&gt;) can make for somewhat</span>
<a name="line-69"></a><span class='hs-comment'>-- more readable 'Applicative' code.  For example, the above example</span>
<a name="line-70"></a><span class='hs-comment'>-- can be rewritten using SHE as</span>
<a name="line-71"></a><span class='hs-comment'>--</span>
<a name="line-72"></a><span class='hs-comment'>-- &gt; {-# OPTIONS_GHC -F -pgmF she #-}</span>
<a name="line-73"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-74"></a><span class='hs-comment'>-- &gt; ... (| mod (| floor (interval 0 100) |) ~7 |)</span>
<a name="line-75"></a><span class='hs-comment'>--</span>
<a name="line-76"></a><span class='hs-comment'>-- There are many functions for transforming and composing active</span>
<a name="line-77"></a><span class='hs-comment'>-- values; see the documentation below for more details.</span>
<a name="line-78"></a><span class='hs-comment'>--</span>
<a name="line-79"></a><span class='hs-comment'>--</span>
<a name="line-80"></a><span class='hs-comment'>-- With careful handling, this module should be suitable to generating</span>
<a name="line-81"></a><span class='hs-comment'>-- deep embeddings if 'Active' values.</span>
<a name="line-82"></a><span class='hs-comment'>--</span>
<a name="line-83"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-84"></a>
<a name="line-85"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Active</span>
<a name="line-86"></a>       <span class='hs-layout'>(</span> <span class='hs-comment'>-- * Representing time</span>
<a name="line-87"></a>
<a name="line-88"></a>         <span class='hs-comment'>-- ** Time and duration</span>
<a name="line-89"></a>
<a name="line-90"></a>         <span class='hs-conid'>Time</span><span class='hs-layout'>,</span> <span class='hs-varid'>toTime</span><span class='hs-layout'>,</span> <span class='hs-varid'>fromTime</span>
<a name="line-91"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>Duration</span><span class='hs-layout'>,</span> <span class='hs-varid'>toDuration</span><span class='hs-layout'>,</span> <span class='hs-varid'>fromDuration</span>
<a name="line-92"></a>
<a name="line-93"></a>         <span class='hs-comment'>-- ** Eras</span>
<a name="line-94"></a>
<a name="line-95"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>Era</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkEra</span>
<a name="line-96"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>start</span><span class='hs-layout'>,</span> <span class='hs-varid'>end</span><span class='hs-layout'>,</span> <span class='hs-varid'>duration</span>
<a name="line-97"></a>
<a name="line-98"></a>         <span class='hs-comment'>-- * Dynamic values</span>
<a name="line-99"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>Dynamic</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkDynamic</span><span class='hs-layout'>,</span> <span class='hs-varid'>onDynamic</span>
<a name="line-100"></a>
<a name="line-101"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>shiftDynamic</span>
<a name="line-102"></a>
<a name="line-103"></a>         <span class='hs-comment'>-- * Active values</span>
<a name="line-104"></a>         <span class='hs-comment'>-- $active</span>
<a name="line-105"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>Active</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkActive</span><span class='hs-layout'>,</span> <span class='hs-varid'>fromDynamic</span><span class='hs-layout'>,</span> <span class='hs-varid'>isConstant</span><span class='hs-layout'>,</span> <span class='hs-varid'>isDynamic</span>
<a name="line-106"></a>
<a name="line-107"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>onActive</span><span class='hs-layout'>,</span> <span class='hs-varid'>modActive</span><span class='hs-layout'>,</span> <span class='hs-varid'>runActive</span>
<a name="line-108"></a>
<a name="line-109"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>activeEra</span><span class='hs-layout'>,</span> <span class='hs-varid'>setEra</span><span class='hs-layout'>,</span> <span class='hs-varid'>atTime</span>
<a name="line-110"></a>
<a name="line-111"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>activeStart</span><span class='hs-layout'>,</span> <span class='hs-varid'>activeEnd</span>
<a name="line-112"></a>
<a name="line-113"></a>         <span class='hs-comment'>-- * Combinators</span>
<a name="line-114"></a>
<a name="line-115"></a>         <span class='hs-comment'>-- ** Special active values</span>
<a name="line-116"></a>
<a name="line-117"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>ui</span><span class='hs-layout'>,</span> <span class='hs-varid'>interval</span>
<a name="line-118"></a>
<a name="line-119"></a>         <span class='hs-comment'>-- ** Transforming active values</span>
<a name="line-120"></a>
<a name="line-121"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>stretch</span><span class='hs-layout'>,</span> <span class='hs-varid'>stretchTo</span><span class='hs-layout'>,</span> <span class='hs-varid'>during</span>
<a name="line-122"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>shift</span><span class='hs-layout'>,</span> <span class='hs-varid'>backwards</span>
<a name="line-123"></a>
<a name="line-124"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>snapshot</span>
<a name="line-125"></a>
<a name="line-126"></a>         <span class='hs-comment'>-- ** Working with values outside the era</span>
<a name="line-127"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>clamp</span><span class='hs-layout'>,</span> <span class='hs-varid'>clampBefore</span><span class='hs-layout'>,</span> <span class='hs-varid'>clampAfter</span>
<a name="line-128"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>trim</span><span class='hs-layout'>,</span> <span class='hs-varid'>trimBefore</span><span class='hs-layout'>,</span> <span class='hs-varid'>trimAfter</span>
<a name="line-129"></a>
<a name="line-130"></a>         <span class='hs-comment'>-- ** Composing active values</span>
<a name="line-131"></a>
<a name="line-132"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>after</span>
<a name="line-133"></a>
<a name="line-134"></a>       <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>-&gt;&gt;</span><span class='hs-layout'>)</span>
<a name="line-135"></a>
<a name="line-136"></a>       <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>|&gt;&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>movie</span>
<a name="line-137"></a>
<a name="line-138"></a>         <span class='hs-comment'>-- * Discretization</span>
<a name="line-139"></a>
<a name="line-140"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>discrete</span>
<a name="line-141"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>simulate</span>
<a name="line-142"></a>
<a name="line-143"></a>       <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-144"></a>
<a name="line-145"></a><span class='hs-cpp'>#if __GLASGOW_HASKELL__ &lt; 710</span>
<a name="line-146"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Applicative</span>
<a name="line-147"></a><span class='hs-cpp'>#endif</span>
<a name="line-148"></a>
<a name="line-149"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span>       <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&amp;&amp;&amp;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-150"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Lens</span>        <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>backwards</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;.&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-151"></a>
<a name="line-152"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Functor</span><span class='hs-varop'>.</span><span class='hs-conid'>Apply</span>
<a name="line-153"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span>
<a name="line-154"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Monoid</span>         <span class='hs-layout'>(</span><span class='hs-conid'>First</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-155"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Semigroup</span>      <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-conid'>First</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-156"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Vector</span>         <span class='hs-keyword'>as</span> <span class='hs-conid'>V</span>
<a name="line-157"></a>
<a name="line-158"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Linear</span>
<a name="line-159"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Linear</span><span class='hs-varop'>.</span><span class='hs-conid'>Affine</span>
<a name="line-160"></a>
<a name="line-161"></a>
<a name="line-162"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-163"></a><span class='hs-comment'>-- Time</span>
<a name="line-164"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-165"></a>
<a name="line-166"></a><a name="Time"></a><span class='hs-comment'>-- | An abstract type for representing /points in time/.  Note that</span>
<a name="line-167"></a><a name="Time"></a><span class='hs-comment'>--   literal numeric values may be used as @Time@s, thanks to the the</span>
<a name="line-168"></a><a name="Time"></a><span class='hs-comment'>--   'Num' and 'Fractional' instances.</span>
<a name="line-169"></a><a name="Time"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Time</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Time</span> <span class='hs-layout'>{</span> <span class='hs-varid'>unTime</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span> <span class='hs-layout'>}</span>
<a name="line-170"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span><span class='hs-layout'>,</span> <span class='hs-conid'>Enum</span><span class='hs-layout'>,</span> <span class='hs-conid'>Num</span><span class='hs-layout'>,</span> <span class='hs-conid'>Fractional</span><span class='hs-layout'>,</span> <span class='hs-conid'>Real</span><span class='hs-layout'>,</span> <span class='hs-conid'>RealFrac</span><span class='hs-layout'>,</span> <span class='hs-conid'>Functor</span><span class='hs-layout'>)</span>
<a name="line-171"></a>
<a name="line-172"></a><a name="makeWrapped"></a><span class='hs-definition'>makeWrapped</span> <span class='hs-chr'>'</span><span class='hs-chr'>'</span><span class='hs-conid'>Time</span>
<a name="line-173"></a>
<a name="line-174"></a><a name="toTime"></a><span class='hs-comment'>-- | A convenient wrapper function to convert a numeric value into a time.</span>
<a name="line-175"></a><span class='hs-definition'>toTime</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-varid'>n</span>
<a name="line-176"></a><span class='hs-definition'>toTime</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Time</span>
<a name="line-177"></a>
<a name="line-178"></a><a name="fromTime"></a><span class='hs-comment'>-- | A convenient unwrapper function to turn a time into a numeric value.</span>
<a name="line-179"></a><span class='hs-definition'>fromTime</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Time</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span>
<a name="line-180"></a><span class='hs-definition'>fromTime</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unTime</span>
<a name="line-181"></a>
<a name="line-182"></a><a name="instance%20Affine%20Time"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Affine</span> <span class='hs-conid'>Time</span> <span class='hs-keyword'>where</span>
<a name="line-183"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>Diff</span> <span class='hs-conid'>Time</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Duration</span>
<a name="line-184"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>Time</span> <span class='hs-varid'>t1</span><span class='hs-layout'>)</span> <span class='hs-varop'>.-.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Time</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Duration</span> <span class='hs-layout'>(</span><span class='hs-varid'>t1</span> <span class='hs-comment'>-</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span>
<a name="line-185"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>Time</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varop'>.+^</span> <span class='hs-layout'>(</span><span class='hs-conid'>Duration</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Time</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span> <span class='hs-varop'>+</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>
<a name="line-186"></a>
<a name="line-187"></a><span class='hs-comment'>-- instance Deadline Time a where</span>
<a name="line-188"></a><span class='hs-comment'>--   -- choose tm deadline (if before / at deadline) (if after deadline)</span>
<a name="line-189"></a><span class='hs-comment'>--   choose t1 t2 a b = if t1 &lt;= t2 then a else b</span>
<a name="line-190"></a>
<a name="line-191"></a><a name="Duration"></a><span class='hs-comment'>-- | An abstract type representing /elapsed time/ between two points</span>
<a name="line-192"></a><a name="Duration"></a><span class='hs-comment'>--   in time.  Note that durations can be negative. Literal numeric</span>
<a name="line-193"></a><a name="Duration"></a><span class='hs-comment'>--   values may be used as @Duration@s thanks to the 'Num' and</span>
<a name="line-194"></a><a name="Duration"></a><span class='hs-comment'>--   'Fractional' instances.</span>
<a name="line-195"></a><a name="Duration"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Duration</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Duration</span> <span class='hs-varid'>n</span>
<a name="line-196"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span><span class='hs-layout'>,</span> <span class='hs-conid'>Enum</span><span class='hs-layout'>,</span> <span class='hs-conid'>Num</span><span class='hs-layout'>,</span> <span class='hs-conid'>Fractional</span><span class='hs-layout'>,</span> <span class='hs-conid'>Real</span><span class='hs-layout'>,</span> <span class='hs-conid'>RealFrac</span><span class='hs-layout'>,</span> <span class='hs-conid'>Functor</span><span class='hs-layout'>)</span>
<a name="line-197"></a>
<a name="line-198"></a><span class='hs-definition'>makeWrapped</span> <span class='hs-chr'>'</span><span class='hs-chr'>'</span><span class='hs-conid'>Duration</span>
<a name="line-199"></a>
<a name="line-200"></a><a name="toDuration"></a><span class='hs-comment'>-- | A convenient wrapper function to convert a numeric value into a duration.</span>
<a name="line-201"></a><span class='hs-definition'>toDuration</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Duration</span> <span class='hs-varid'>n</span>
<a name="line-202"></a><span class='hs-definition'>toDuration</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Duration</span>
<a name="line-203"></a>
<a name="line-204"></a><a name="fromDuration"></a><span class='hs-comment'>-- | A convenient unwrapper function to turn a duration into a numeric value.</span>
<a name="line-205"></a><span class='hs-definition'>fromDuration</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Duration</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span>
<a name="line-206"></a><span class='hs-definition'>fromDuration</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>op</span> <span class='hs-conid'>Duration</span>
<a name="line-207"></a>
<a name="line-208"></a><a name="instance%20Applicative%20Duration"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Applicative</span> <span class='hs-conid'>Duration</span> <span class='hs-keyword'>where</span>
<a name="line-209"></a>  <span class='hs-varid'>pure</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Duration</span>
<a name="line-210"></a>  <span class='hs-conid'>Duration</span> <span class='hs-varid'>f</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-conid'>Duration</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Duration</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-211"></a>
<a name="line-212"></a><a name="instance%20Additive%20Duration"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Additive</span> <span class='hs-conid'>Duration</span> <span class='hs-keyword'>where</span>
<a name="line-213"></a>  <span class='hs-varid'>zero</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-214"></a>
<a name="line-215"></a><a name="instance%20Semigroup%20(Duration%20n)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Semigroup</span> <span class='hs-layout'>(</span><span class='hs-conid'>Duration</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-216"></a>  <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>^+^</span><span class='hs-layout'>)</span>
<a name="line-217"></a>
<a name="line-218"></a><a name="instance%20Monoid%20(Duration%20n)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>Duration</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-219"></a>  <span class='hs-varid'>mappend</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span>
<a name="line-220"></a>  <span class='hs-varid'>mempty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<a name="line-221"></a>
<a name="line-222"></a><a name="Era"></a><span class='hs-comment'>-- | An @Era@ is a concrete span of time, that is, a pair of times</span>
<a name="line-223"></a><a name="Era"></a><span class='hs-comment'>--   representing the start and end of the era. @Era@s form a</span>
<a name="line-224"></a><a name="Era"></a><span class='hs-comment'>--   semigroup: the combination of two @Era@s is the smallest @Era@</span>
<a name="line-225"></a><a name="Era"></a><span class='hs-comment'>--   which contains both.  They do not form a 'Monoid', since there is</span>
<a name="line-226"></a><a name="Era"></a><span class='hs-comment'>--   no @Era@ which acts as the identity with respect to this</span>
<a name="line-227"></a><a name="Era"></a><span class='hs-comment'>--   combining operation.</span>
<a name="line-228"></a><a name="Era"></a><span class='hs-comment'>--</span>
<a name="line-229"></a><a name="Era"></a><span class='hs-comment'>--   @Era@ is abstract. To construct @Era@ values, use 'mkEra'; to</span>
<a name="line-230"></a><a name="Era"></a><span class='hs-comment'>--   deconstruct, use 'start' and 'end'.</span>
<a name="line-231"></a><a name="Era"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Era</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Era</span> <span class='hs-layout'>(</span><span class='hs-conid'>Min</span> <span class='hs-layout'>(</span><span class='hs-conid'>Time</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Max</span> <span class='hs-layout'>(</span><span class='hs-conid'>Time</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-232"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Semigroup</span><span class='hs-layout'>)</span>
<a name="line-233"></a>
<a name="line-234"></a>
<a name="line-235"></a><a name="mkEra"></a><span class='hs-comment'>-- | Create an 'Era' by specifying start and end 'Time's.</span>
<a name="line-236"></a><span class='hs-definition'>mkEra</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Time</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Era</span> <span class='hs-varid'>n</span>
<a name="line-237"></a><span class='hs-definition'>mkEra</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Era</span> <span class='hs-layout'>(</span><span class='hs-conid'>Min</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>Max</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-238"></a>
<a name="line-239"></a><a name="start"></a><span class='hs-comment'>-- | Get the start 'Time' of an 'Era'.</span>
<a name="line-240"></a><span class='hs-definition'>start</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Era</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-varid'>n</span>
<a name="line-241"></a><span class='hs-definition'>start</span> <span class='hs-layout'>(</span><span class='hs-conid'>Era</span> <span class='hs-layout'>(</span><span class='hs-conid'>Min</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-242"></a>
<a name="line-243"></a><a name="end"></a><span class='hs-comment'>-- | Get the end 'Time' of an 'Era'.</span>
<a name="line-244"></a><span class='hs-definition'>end</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Era</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-varid'>n</span>
<a name="line-245"></a><span class='hs-definition'>end</span> <span class='hs-layout'>(</span><span class='hs-conid'>Era</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Max</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-246"></a>
<a name="line-247"></a><a name="duration"></a><span class='hs-comment'>-- | Compute the 'Duration' of an 'Era'.</span>
<a name="line-248"></a><span class='hs-definition'>duration</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Num</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Era</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Duration</span> <span class='hs-varid'>n</span>
<a name="line-249"></a><span class='hs-definition'>duration</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>.-.</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>end</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>start</span>
<a name="line-250"></a>
<a name="line-251"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-252"></a><span class='hs-comment'>-- Dynamic</span>
<a name="line-253"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-254"></a>
<a name="line-255"></a><span class='hs-comment'>-- | A @Dynamic a@ can be thought of as an @a@ value that changes over</span>
<a name="line-256"></a><span class='hs-comment'>--   the course of a particular 'Era'.  It's envisioned that @Dynamic@</span>
<a name="line-257"></a><span class='hs-comment'>--   will be mostly an internal implementation detail and that</span>
<a name="line-258"></a><span class='hs-comment'>--   'Active' will be most commonly used.  But you never know what</span>
<a name="line-259"></a><span class='hs-comment'>--   uses people might find for things.</span>
<a name="line-260"></a>
<a name="line-261"></a><a name="Dynamic"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Dynamic</span> <span class='hs-layout'>{</span> <span class='hs-varid'>era</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Era</span> <span class='hs-conid'>Rational</span>
<a name="line-262"></a>                         <span class='hs-layout'>,</span> <span class='hs-varid'>runDynamic</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-263"></a>                         <span class='hs-layout'>}</span>
<a name="line-264"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Functor</span>
<a name="line-265"></a>
<a name="line-266"></a><span class='hs-comment'>-- | 'Dynamic' is an instance of 'Apply' (/i.e./ 'Applicative' without</span>
<a name="line-267"></a><span class='hs-comment'>--   'pure'): a time-varying function is applied to a time-varying</span>
<a name="line-268"></a><span class='hs-comment'>--   value pointwise; the era of the result is the combination of the</span>
<a name="line-269"></a><span class='hs-comment'>--   function and value eras.  Note, however, that 'Dynamic' is /not/</span>
<a name="line-270"></a><span class='hs-comment'>--   an instance of 'Applicative' since there is no way to implement</span>
<a name="line-271"></a><span class='hs-comment'>--   'pure': the era would have to be empty, but there is no such</span>
<a name="line-272"></a><span class='hs-comment'>--   thing as an empty era (that is, 'Era' is not an instance of</span>
<a name="line-273"></a><span class='hs-comment'>--   'Monoid').</span>
<a name="line-274"></a>
<a name="line-275"></a><a name="instance%20Apply%20Dynamic"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Apply</span> <span class='hs-conid'>Dynamic</span> <span class='hs-keyword'>where</span>
<a name="line-276"></a>  <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>d1</span> <span class='hs-varid'>f1</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>d2</span> <span class='hs-varid'>f2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Dynamic</span> <span class='hs-layout'>(</span><span class='hs-varid'>d1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>d2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f1</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-varid'>f2</span><span class='hs-layout'>)</span>
<a name="line-277"></a>
<a name="line-278"></a><a name="instance%20Semigroup%20(Dynamic%20a)"></a><span class='hs-comment'>-- | @'Dynamic' a@ is a 'Semigroup' whenever @a@ is: the eras are</span>
<a name="line-279"></a><a name="instance%20Semigroup%20(Dynamic%20a)"></a><span class='hs-comment'>--   combined according to their semigroup structure, and the values</span>
<a name="line-280"></a><a name="instance%20Semigroup%20(Dynamic%20a)"></a><span class='hs-comment'>--   of type @a@ are combined pointwise.  Note that @'Dynamic' a@ cannot</span>
<a name="line-281"></a><a name="instance%20Semigroup%20(Dynamic%20a)"></a><span class='hs-comment'>--   be an instance of 'Monoid' since 'Era' is not.</span>
<a name="line-282"></a><a name="instance%20Semigroup%20(Dynamic%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Semigroup</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-283"></a>  <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>d1</span> <span class='hs-varid'>f1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>d2</span> <span class='hs-varid'>f2</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Dynamic</span> <span class='hs-layout'>(</span><span class='hs-varid'>d1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>d2</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>f1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>f2</span><span class='hs-layout'>)</span>
<a name="line-284"></a>
<a name="line-285"></a><a name="mkDynamic"></a><span class='hs-comment'>-- | Create a 'Dynamic' from a start time, an end time, and a</span>
<a name="line-286"></a><span class='hs-comment'>--   time-varying value.</span>
<a name="line-287"></a><span class='hs-definition'>mkDynamic</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span>
<a name="line-288"></a><span class='hs-definition'>mkDynamic</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Dynamic</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkEra</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-289"></a>
<a name="line-290"></a><a name="onDynamic"></a><span class='hs-comment'>-- | Fold for 'Dynamic'.</span>
<a name="line-291"></a><span class='hs-definition'>onDynamic</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-292"></a><span class='hs-definition'>onDynamic</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>e</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>start</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>end</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>d</span>
<a name="line-293"></a>
<a name="line-294"></a><a name="shiftDynamic"></a><span class='hs-comment'>-- | Shift a 'Dynamic' value by a certain duration.</span>
<a name="line-295"></a><span class='hs-definition'>shiftDynamic</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Duration</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span>
<a name="line-296"></a><span class='hs-definition'>shiftDynamic</span> <span class='hs-varid'>sh</span> <span class='hs-keyglyph'>=</span>
<a name="line-297"></a>  <span class='hs-varid'>onDynamic</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-298"></a>    <span class='hs-varid'>mkDynamic</span>
<a name="line-299"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>.+^</span> <span class='hs-varid'>sh</span><span class='hs-layout'>)</span>
<a name="line-300"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-varop'>.+^</span> <span class='hs-varid'>sh</span><span class='hs-layout'>)</span>
<a name="line-301"></a>      <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span> <span class='hs-varop'>.-^</span> <span class='hs-varid'>sh</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-302"></a>
<a name="line-303"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-304"></a><span class='hs-comment'>--  Active</span>
<a name="line-305"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-306"></a>
<a name="line-307"></a><span class='hs-comment'>-- $active</span>
<a name="line-308"></a><span class='hs-comment'>-- For working with time-varying values, it is convenient to have an</span>
<a name="line-309"></a><span class='hs-comment'>-- 'Applicative' instance: '&lt;*&gt;' lets us apply time-varying</span>
<a name="line-310"></a><span class='hs-comment'>-- functions to time-varying values; 'pure' allows treating constants</span>
<a name="line-311"></a><span class='hs-comment'>-- as time-varying values which do not vary.  However, as explained in</span>
<a name="line-312"></a><span class='hs-comment'>-- its documentation, 'Dynamic' cannot be made an instance of</span>
<a name="line-313"></a><span class='hs-comment'>-- 'Applicative' since there is no way to implement 'pure'.  The</span>
<a name="line-314"></a><span class='hs-comment'>-- problem is that all 'Dynamic' values must have a finite start and</span>
<a name="line-315"></a><span class='hs-comment'>-- end time.  The solution is to adjoin a special constructor for</span>
<a name="line-316"></a><span class='hs-comment'>-- pure/constant values with no start or end time, giving us 'Active'.</span>
<a name="line-317"></a>
<a name="line-318"></a><a name="Active"></a><span class='hs-comment'>-- | There are two types of @Active@ values:</span>
<a name="line-319"></a><a name="Active"></a><span class='hs-comment'>--</span>
<a name="line-320"></a><a name="Active"></a><span class='hs-comment'>--   * An 'Active' can simply be a 'Dynamic', that is, a time-varying</span>
<a name="line-321"></a><a name="Active"></a><span class='hs-comment'>--     value with start and end times.</span>
<a name="line-322"></a><a name="Active"></a><span class='hs-comment'>--</span>
<a name="line-323"></a><a name="Active"></a><span class='hs-comment'>--   * An 'Active' value can also be a constant: a single value,</span>
<a name="line-324"></a><a name="Active"></a><span class='hs-comment'>--     constant across time, with no start and end times.</span>
<a name="line-325"></a><a name="Active"></a><span class='hs-comment'>--</span>
<a name="line-326"></a><a name="Active"></a><span class='hs-comment'>--   The addition of constant values enable 'Monoid' and 'Applicative'</span>
<a name="line-327"></a><a name="Active"></a><span class='hs-comment'>--   instances for 'Active'.</span>
<a name="line-328"></a><a name="Active"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Active</span> <span class='hs-layout'>(</span><span class='hs-conid'>MaybeApply</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-329"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Functor</span><span class='hs-layout'>,</span> <span class='hs-conid'>Apply</span><span class='hs-layout'>,</span> <span class='hs-conid'>Applicative</span><span class='hs-layout'>)</span>
<a name="line-330"></a>
<a name="line-331"></a><span class='hs-definition'>makeWrapped</span> <span class='hs-chr'>'</span><span class='hs-chr'>'</span><span class='hs-conid'>Active</span>
<a name="line-332"></a><span class='hs-definition'>makeWrapped</span> <span class='hs-chr'>'</span><span class='hs-chr'>'</span><span class='hs-conid'>MaybeApply</span>
<a name="line-333"></a>
<a name="line-334"></a><a name="active"></a><span class='hs-definition'>active</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Iso'</span> <span class='hs-layout'>(</span><span class='hs-conid'>Active</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-335"></a><span class='hs-definition'>active</span> <span class='hs-keyglyph'>=</span> <span class='hs-sel'>_Wrapped</span> <span class='hs-varop'>.</span> <span class='hs-sel'>_Wrapped</span>
<a name="line-336"></a>
<a name="line-337"></a><a name="instance%20Semigroup%20(Active%20a)"></a><span class='hs-comment'>-- | Active values over a type with a 'Semigroup' instance are also an</span>
<a name="line-338"></a><a name="instance%20Semigroup%20(Active%20a)"></a><span class='hs-comment'>--   instance of 'Semigroup'.  Two active values are combined</span>
<a name="line-339"></a><a name="instance%20Semigroup%20(Active%20a)"></a><span class='hs-comment'>--   pointwise; the resulting value is constant iff both inputs are.</span>
<a name="line-340"></a><a name="instance%20Semigroup%20(Active%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Semigroup</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Semigroup</span> <span class='hs-layout'>(</span><span class='hs-conid'>Active</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-341"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>view</span> <span class='hs-varid'>active</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>view</span> <span class='hs-varid'>active</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>review</span> <span class='hs-varid'>active</span> <span class='hs-varop'>$</span> <span class='hs-varid'>combine</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-342"></a>   <span class='hs-keyword'>where</span>
<a name="line-343"></a>     <span class='hs-varid'>combine</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>m1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>m2</span><span class='hs-layout'>)</span>
<a name="line-344"></a>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-varid'>m1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>m2</span><span class='hs-layout'>)</span>
<a name="line-345"></a>
<a name="line-346"></a>     <span class='hs-varid'>combine</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>dur</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-347"></a>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>dur</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>const</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-348"></a>
<a name="line-349"></a>     <span class='hs-varid'>combine</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>dur</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-350"></a>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>dur</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>m</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-351"></a>
<a name="line-352"></a>     <span class='hs-varid'>combine</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>d1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>d2</span><span class='hs-layout'>)</span>
<a name="line-353"></a>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Left</span> <span class='hs-layout'>(</span><span class='hs-varid'>d1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>d2</span><span class='hs-layout'>)</span>
<a name="line-354"></a>
<a name="line-355"></a><a name="instance%20Monoid%20(Active%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Semigroup</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>Active</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-356"></a>  <span class='hs-varid'>mempty</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Active</span> <span class='hs-layout'>(</span><span class='hs-conid'>MaybeApply</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>mempty</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-357"></a>  <span class='hs-varid'>mappend</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-layout'>)</span>
<a name="line-358"></a>
<a name="line-359"></a><a name="fromDynamic"></a><span class='hs-comment'>-- | Create an 'Active' value from a 'Dynamic'.</span>
<a name="line-360"></a><span class='hs-definition'>fromDynamic</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-361"></a><span class='hs-definition'>fromDynamic</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Active</span> <span class='hs-varop'>.</span> <span class='hs-conid'>MaybeApply</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Left</span>
<a name="line-362"></a>
<a name="line-363"></a><a name="mkActive"></a><span class='hs-comment'>-- | Create a dynamic 'Active' from a start time, an end time, and a</span>
<a name="line-364"></a><span class='hs-comment'>--   time-varying value.</span>
<a name="line-365"></a><span class='hs-definition'>mkActive</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-366"></a><span class='hs-definition'>mkActive</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromDynamic</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkDynamic</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-367"></a>
<a name="line-368"></a><a name="onActive"></a><span class='hs-comment'>-- | Fold for 'Active's.  Process an 'Active a', given a function to</span>
<a name="line-369"></a><span class='hs-comment'>--   apply if it is a pure (constant) value, and a function to apply if</span>
<a name="line-370"></a><span class='hs-comment'>--   it is a 'Dynamic'.</span>
<a name="line-371"></a><span class='hs-definition'>onActive</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-372"></a><span class='hs-definition'>onActive</span> <span class='hs-varid'>f</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Active</span> <span class='hs-layout'>(</span><span class='hs-conid'>MaybeApply</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span>
<a name="line-373"></a><span class='hs-definition'>onActive</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Active</span> <span class='hs-layout'>(</span><span class='hs-conid'>MaybeApply</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>d</span>
<a name="line-374"></a>
<a name="line-375"></a><a name="modActive"></a><span class='hs-comment'>-- | Modify an 'Active' value using a case analysis to see whether it</span>
<a name="line-376"></a><span class='hs-comment'>--   is constant or dynamic.</span>
<a name="line-377"></a><span class='hs-definition'>modActive</span>
<a name="line-378"></a>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-379"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-380"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>b</span>
<a name="line-381"></a><span class='hs-definition'>modActive</span> <span class='hs-varid'>f</span> <span class='hs-varid'>g</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onActive</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromDynamic</span> <span class='hs-varop'>.</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span>
<a name="line-382"></a>
<a name="line-383"></a><a name="runActive"></a><span class='hs-comment'>-- | Interpret an 'Active' value as a function from time.</span>
<a name="line-384"></a><span class='hs-definition'>runActive</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-385"></a><span class='hs-definition'>runActive</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onActive</span> <span class='hs-varid'>const</span> <span class='hs-varid'>runDynamic</span>
<a name="line-386"></a>
<a name="line-387"></a><a name="activeStart"></a><span class='hs-comment'>-- | Get the value of an @Active a@ at the beginning of its era.</span>
<a name="line-388"></a><span class='hs-definition'>activeStart</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-389"></a><span class='hs-definition'>activeStart</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onActive</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-varid'>onDynamic</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-390"></a>
<a name="line-391"></a><a name="activeEnd"></a><span class='hs-comment'>-- | Get the value of an @Active a@ at the end of its era.</span>
<a name="line-392"></a><span class='hs-definition'>activeEnd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-393"></a><span class='hs-definition'>activeEnd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onActive</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-varid'>onDynamic</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-varid'>e</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-394"></a>
<a name="line-395"></a><a name="activeEra"></a><span class='hs-comment'>-- | Get the 'Era' of an 'Active' value (or 'Nothing' if it is</span>
<a name="line-396"></a><span class='hs-comment'>--   a constant/pure value).</span>
<a name="line-397"></a><span class='hs-definition'>activeEra</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Era</span> <span class='hs-conid'>Rational</span><span class='hs-layout'>)</span>
<a name="line-398"></a><span class='hs-definition'>activeEra</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onActive</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>.</span> <span class='hs-varid'>era</span><span class='hs-layout'>)</span>
<a name="line-399"></a>
<a name="line-400"></a><a name="isConstant"></a><span class='hs-comment'>-- | Test whether an 'Active' value is constant.</span>
<a name="line-401"></a><span class='hs-definition'>isConstant</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-402"></a><span class='hs-definition'>isConstant</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onActive</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-403"></a>
<a name="line-404"></a><a name="isDynamic"></a><span class='hs-comment'>-- | Test whether an 'Active' value is 'Dynamic'.</span>
<a name="line-405"></a><span class='hs-definition'>isDynamic</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-406"></a><span class='hs-definition'>isDynamic</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onActive</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-407"></a>
<a name="line-408"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-409"></a><span class='hs-comment'>--  Combinators</span>
<a name="line-410"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-411"></a>
<a name="line-412"></a><a name="ui"></a><span class='hs-comment'>-- | @ui@ represents the /unit interval/, which takes on the value @t@</span>
<a name="line-413"></a><span class='hs-comment'>--   at time @t@, and has as its era @[0,1]@. It is equivalent to</span>
<a name="line-414"></a><span class='hs-comment'>--   @'interval' 0 1@, and can be visualized as follows:</span>
<a name="line-415"></a><span class='hs-comment'>--</span>
<a name="line-416"></a><span class='hs-comment'>--   &lt;&lt;diagrams/src_Data_Active_uiDia.svg#diagram=uiDia&amp;width=200&gt;&gt;</span>
<a name="line-417"></a><span class='hs-comment'>--</span>
<a name="line-418"></a><span class='hs-comment'>--   On the x-axis is time, and the value that @ui@ takes on is on the</span>
<a name="line-419"></a><span class='hs-comment'>--   y-axis.  The shaded portion represents the era.  Note that the</span>
<a name="line-420"></a><span class='hs-comment'>--   value of @ui@ (as with any active) is still defined outside its</span>
<a name="line-421"></a><span class='hs-comment'>--   era, and this can make a difference when it is combined with</span>
<a name="line-422"></a><span class='hs-comment'>--   other active values with different eras.  Applying a function</span>
<a name="line-423"></a><span class='hs-comment'>--   with 'fmap' affects all values, both inside and outside the era.</span>
<a name="line-424"></a><span class='hs-comment'>--   To manipulate values outside the era specifically, see 'clamp'</span>
<a name="line-425"></a><span class='hs-comment'>--   and 'trim'.</span>
<a name="line-426"></a><span class='hs-comment'>--</span>
<a name="line-427"></a><span class='hs-comment'>--   To alter the /values/ that @ui@ takes on without altering its</span>
<a name="line-428"></a><span class='hs-comment'>--   era, use its 'Functor' and 'Applicative' instances.  For example,</span>
<a name="line-429"></a><span class='hs-comment'>--   @(*2) \&lt;$\&gt; ui@ varies from @0@ to @2@ over the era @[0,1]@.  To</span>
<a name="line-430"></a><span class='hs-comment'>--   alter the era, you can use 'stretch' or 'shift'.</span>
<a name="line-431"></a><span class='hs-definition'>ui</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Fractional</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-432"></a><span class='hs-definition'>ui</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>interval</span> <span class='hs-num'>0</span> <span class='hs-num'>1</span>
<a name="line-433"></a>
<a name="line-434"></a><a name="interval"></a><span class='hs-comment'>-- | @interval a b@ is an active value starting at time @a@, ending at</span>
<a name="line-435"></a><span class='hs-comment'>--   time @b@, and taking the value @t@ at time @t@.</span>
<a name="line-436"></a><span class='hs-definition'>interval</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Fractional</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-437"></a><span class='hs-definition'>interval</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkActive</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromRational</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unTime</span><span class='hs-layout'>)</span>
<a name="line-438"></a>
<a name="line-439"></a><a name="stretch"></a><span class='hs-comment'>-- | @stretch s act@ \"stretches\" the active @act@ so that it takes</span>
<a name="line-440"></a><span class='hs-comment'>--   @s@ times as long (retaining the same start time).</span>
<a name="line-441"></a><span class='hs-definition'>stretch</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-442"></a><span class='hs-definition'>stretch</span> <span class='hs-varid'>str</span> <span class='hs-keyglyph'>=</span>
<a name="line-443"></a>  <span class='hs-varid'>modActive</span> <span class='hs-varid'>id</span> <span class='hs-varop'>.</span> <span class='hs-varid'>onDynamic</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-444"></a>    <span class='hs-varid'>mkDynamic</span> <span class='hs-varid'>s</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>.+^</span> <span class='hs-layout'>(</span><span class='hs-varid'>str</span> <span class='hs-varop'>*^</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-varop'>.-.</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-445"></a>      <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>.+^</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>t</span> <span class='hs-varop'>.-.</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varop'>^/</span> <span class='hs-varid'>str</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-446"></a>
<a name="line-447"></a><span class='hs-comment'>-- | @stretchTo d@ 'stretch'es an 'Active' so it has duration @d@.</span>
<a name="line-448"></a><span class='hs-comment'>--   Has no effect if (1) @d@ is non-positive, or (2) the 'Active'</span>
<a name="line-449"></a><span class='hs-comment'>--   value is constant, or (3) the 'Active' value has zero duration.</span>
<a name="line-450"></a><span class='hs-comment'>-- [AJG: conditions (1) and (3) no longer true: to consider changing]</span>
<a name="line-451"></a>
<a name="line-452"></a><a name="stretchTo"></a><span class='hs-definition'>stretchTo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Duration</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-453"></a><span class='hs-definition'>stretchTo</span> <span class='hs-varid'>d</span> <span class='hs-varid'>a</span>
<a name="line-454"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>d</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>                               <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-455"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-layout'>(</span><span class='hs-varid'>duration</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>activeEra</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varop'>==</span> <span class='hs-conid'>Just</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-456"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varop'>`stretch`</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>toRational</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varid'>d</span> <span class='hs-varop'>/</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>duration</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>activeEra</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-457"></a>
<a name="line-458"></a><a name="during"></a><span class='hs-comment'>-- | @a1 \`during\` a2@ 'stretch'es and 'shift's @a1@ so that it has the</span>
<a name="line-459"></a><span class='hs-comment'>--   same era as @a2@.  Has no effect if either of @a1@ or @a2@ are constant.</span>
<a name="line-460"></a><span class='hs-definition'>during</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-461"></a><span class='hs-definition'>during</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>a1</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>stretchTo</span> <span class='hs-varid'>d</span> <span class='hs-varop'>.</span> <span class='hs-varid'>atTime</span> <span class='hs-varid'>s</span> <span class='hs-varop'>$</span> <span class='hs-varid'>a1</span><span class='hs-layout'>)</span>
<a name="line-462"></a>                 <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>duration</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varid'>start</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>activeEra</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span>
<a name="line-463"></a>
<a name="line-464"></a><a name="shift"></a><span class='hs-comment'>-- | @shift d act@ shifts the start time of @act@ by duration @d@.</span>
<a name="line-465"></a><span class='hs-comment'>--   Has no effect on constant values.</span>
<a name="line-466"></a><span class='hs-definition'>shift</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Duration</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-467"></a><span class='hs-definition'>shift</span> <span class='hs-varid'>sh</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>modActive</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-varid'>shiftDynamic</span> <span class='hs-varid'>sh</span><span class='hs-layout'>)</span>
<a name="line-468"></a>
<a name="line-469"></a><a name="backwards"></a><span class='hs-comment'>-- | Reverse an active value so the start of its era gets mapped to</span>
<a name="line-470"></a><span class='hs-comment'>--   the end and vice versa.  For example, @backwards 'ui'@ can be</span>
<a name="line-471"></a><span class='hs-comment'>--   visualized as</span>
<a name="line-472"></a><span class='hs-comment'>--</span>
<a name="line-473"></a><span class='hs-comment'>--   &lt;&lt;diagrams/src_Data_Active_backwardsDia.svg#diagram=backwardsDia&amp;width=200&gt;&gt;</span>
<a name="line-474"></a><span class='hs-definition'>backwards</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-475"></a><span class='hs-definition'>backwards</span> <span class='hs-keyglyph'>=</span>
<a name="line-476"></a>  <span class='hs-varid'>modActive</span> <span class='hs-varid'>id</span> <span class='hs-varop'>.</span> <span class='hs-varid'>onDynamic</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-477"></a>    <span class='hs-varid'>mkDynamic</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span>
<a name="line-478"></a>      <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>.+^</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span> <span class='hs-varop'>.-.</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-479"></a>
<a name="line-480"></a>
<a name="line-481"></a><a name="snapshot"></a><span class='hs-comment'>-- | Take a \"snapshot\" of an active value at a particular time,</span>
<a name="line-482"></a><span class='hs-comment'>--   resulting in a constant value.</span>
<a name="line-483"></a><span class='hs-definition'>snapshot</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-484"></a><span class='hs-definition'>snapshot</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-layout'>(</span><span class='hs-varid'>runActive</span> <span class='hs-varid'>a</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-485"></a>
<a name="line-486"></a><span class='hs-comment'>-- | \"Clamp\" an active value so that it is constant before and after</span>
<a name="line-487"></a><span class='hs-comment'>--   its era.  Before the era, @clamp a@ takes on the value of @a@ at</span>
<a name="line-488"></a><span class='hs-comment'>--   the start of the era.  Likewise, after the era, @clamp a@ takes</span>
<a name="line-489"></a><span class='hs-comment'>--   on the value of @a@ at the end of the era. @clamp@ has no effect</span>
<a name="line-490"></a><span class='hs-comment'>--   on constant values.</span>
<a name="line-491"></a><span class='hs-comment'>--</span>
<a name="line-492"></a><span class='hs-comment'>--   For example, @clamp 'ui'@ can be visualized as</span>
<a name="line-493"></a><span class='hs-comment'>--</span>
<a name="line-494"></a><span class='hs-comment'>--   &lt;&lt;diagrams/src_Data_Active_clampDia.svg#diagram=clampDia&amp;width=200&gt;&gt;</span>
<a name="line-495"></a><span class='hs-comment'>--</span>
<a name="line-496"></a><span class='hs-comment'>--   See also 'clampBefore' and 'clampAfter', which clamp only before</span>
<a name="line-497"></a><span class='hs-comment'>--   or after the era, respectively.</span>
<a name="line-498"></a>
<a name="line-499"></a><a name="clamp"></a><span class='hs-definition'>clamp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-500"></a><span class='hs-definition'>clamp</span> <span class='hs-keyglyph'>=</span>
<a name="line-501"></a>  <span class='hs-varid'>modActive</span> <span class='hs-varid'>id</span> <span class='hs-varop'>.</span> <span class='hs-varid'>onDynamic</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-502"></a>    <span class='hs-varid'>mkDynamic</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span>
<a name="line-503"></a>      <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-conid'>()</span> <span class='hs-keyword'>of</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>s</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-varid'>s</span>
<a name="line-504"></a>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&gt;</span> <span class='hs-varid'>e</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-varid'>e</span>
<a name="line-505"></a>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-varid'>t</span>
<a name="line-506"></a>      <span class='hs-layout'>)</span>
<a name="line-507"></a>
<a name="line-508"></a><a name="clampBefore"></a><span class='hs-comment'>-- | \"Clamp\" an active value so that it is constant before the start</span>
<a name="line-509"></a><span class='hs-comment'>--   of its era. For example, @clampBefore 'ui'@ can be visualized as</span>
<a name="line-510"></a><span class='hs-comment'>--</span>
<a name="line-511"></a><span class='hs-comment'>--   &lt;&lt;diagrams/src_Data_Active_clampBeforeDia.svg#diagram=clampBeforeDia&amp;width=200&gt;&gt;</span>
<a name="line-512"></a><span class='hs-comment'>--</span>
<a name="line-513"></a><span class='hs-comment'>--   See the documentation of 'clamp' for more information.</span>
<a name="line-514"></a><span class='hs-definition'>clampBefore</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-515"></a><span class='hs-definition'>clampBefore</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
<a name="line-516"></a>
<a name="line-517"></a><span class='hs-comment'>--- XXX These are undefined!</span>
<a name="line-518"></a>
<a name="line-519"></a><a name="clampAfter"></a><span class='hs-comment'>-- | \"Clamp\" an active value so that it is constant after the end</span>
<a name="line-520"></a><span class='hs-comment'>--   of its era.  For example, @clampBefore 'ui'@ can be visualized as</span>
<a name="line-521"></a><span class='hs-comment'>--</span>
<a name="line-522"></a><span class='hs-comment'>--   &lt;&lt;diagrams/src_Data_Active_clampAfterDia.svg#diagram=clampAfterDia&amp;width=200&gt;&gt;</span>
<a name="line-523"></a><span class='hs-comment'>--</span>
<a name="line-524"></a><span class='hs-comment'>--   See the documentation of 'clamp' for more information.</span>
<a name="line-525"></a><span class='hs-definition'>clampAfter</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-526"></a><span class='hs-definition'>clampAfter</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>undefined</span>
<a name="line-527"></a>
<a name="line-528"></a>
<a name="line-529"></a><span class='hs-comment'>-- | \"Trim\" an active value so that it is empty outside its era.</span>
<a name="line-530"></a><span class='hs-comment'>--   @trim@ has no effect on constant values.</span>
<a name="line-531"></a><span class='hs-comment'>--</span>
<a name="line-532"></a><span class='hs-comment'>--   For example, @trim 'ui'@ can be visualized as</span>
<a name="line-533"></a><span class='hs-comment'>--</span>
<a name="line-534"></a><span class='hs-comment'>--   &lt;&lt;diagrams/src_Data_Active_trimDia.svg#diagram=trimDia&amp;width=200&gt;&gt;</span>
<a name="line-535"></a><span class='hs-comment'>--</span>
<a name="line-536"></a><span class='hs-comment'>--   Actually, @trim ui@ is not well-typed, since it is not guaranteed</span>
<a name="line-537"></a><span class='hs-comment'>--   that @ui@'s values will be monoidal (and usually they won't be)!</span>
<a name="line-538"></a><span class='hs-comment'>--   But the above image still provides a good intuitive idea of what</span>
<a name="line-539"></a><span class='hs-comment'>--   @trim@ is doing. To make this precise we could consider something</span>
<a name="line-540"></a><span class='hs-comment'>--   like @trim (First . Just &lt;$&gt; ui)@.</span>
<a name="line-541"></a><span class='hs-comment'>--</span>
<a name="line-542"></a><span class='hs-comment'>--   See also 'trimBefore' and 'trimActive', which trim only before or</span>
<a name="line-543"></a><span class='hs-comment'>--   after the era, respectively.</span>
<a name="line-544"></a>
<a name="line-545"></a><a name="trim"></a><span class='hs-definition'>trim</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-546"></a><span class='hs-definition'>trim</span> <span class='hs-keyglyph'>=</span>
<a name="line-547"></a>  <span class='hs-varid'>modActive</span> <span class='hs-varid'>id</span> <span class='hs-varop'>.</span> <span class='hs-varid'>onDynamic</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-548"></a>    <span class='hs-varid'>mkDynamic</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span>
<a name="line-549"></a>      <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-conid'>()</span> <span class='hs-keyword'>of</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>s</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mempty</span>
<a name="line-550"></a>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&gt;</span> <span class='hs-varid'>e</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mempty</span>
<a name="line-551"></a>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-varid'>t</span>
<a name="line-552"></a>      <span class='hs-layout'>)</span>
<a name="line-553"></a>
<a name="line-554"></a>
<a name="line-555"></a><a name="trimBefore"></a><span class='hs-comment'>-- | \"Trim\" an active value so that it is empty /before/ the start</span>
<a name="line-556"></a><span class='hs-comment'>--   of its era. For example, @trimBefore 'ui'@ can be visualized as</span>
<a name="line-557"></a><span class='hs-comment'>--</span>
<a name="line-558"></a><span class='hs-comment'>--   &lt;&lt;diagrams/src_Data_Active_trimBeforeDia.svg#diagram=trimBeforeDia&amp;width=200&gt;&gt;</span>
<a name="line-559"></a><span class='hs-comment'>--</span>
<a name="line-560"></a><span class='hs-comment'>--   See the documentation of 'trim' for more details.</span>
<a name="line-561"></a><span class='hs-definition'>trimBefore</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-562"></a><span class='hs-definition'>trimBefore</span> <span class='hs-keyglyph'>=</span>
<a name="line-563"></a>  <span class='hs-varid'>modActive</span> <span class='hs-varid'>id</span> <span class='hs-varop'>.</span> <span class='hs-varid'>onDynamic</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-564"></a>    <span class='hs-varid'>mkDynamic</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span>
<a name="line-565"></a>      <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-conid'>()</span> <span class='hs-keyword'>of</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>s</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mempty</span>
<a name="line-566"></a>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-varid'>t</span>
<a name="line-567"></a>      <span class='hs-layout'>)</span>
<a name="line-568"></a>
<a name="line-569"></a><a name="trimAfter"></a><span class='hs-comment'>-- | \"Trim\" an active value so that it is empty /after/ the end</span>
<a name="line-570"></a><span class='hs-comment'>--   of its era.  For example, @trimAfter 'ui'@ can be visualized as</span>
<a name="line-571"></a><span class='hs-comment'>--</span>
<a name="line-572"></a><span class='hs-comment'>--   &lt;&lt;diagrams/src_Data_Active_trimAfterDia.svg#diagram=trimAfterDia&amp;width=200&gt;&gt;</span>
<a name="line-573"></a><span class='hs-comment'>--</span>
<a name="line-574"></a><span class='hs-comment'>--   See the documentation of 'trim' for more details.</span>
<a name="line-575"></a><span class='hs-definition'>trimAfter</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Monoid</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-576"></a><span class='hs-definition'>trimAfter</span> <span class='hs-keyglyph'>=</span>
<a name="line-577"></a>  <span class='hs-varid'>modActive</span> <span class='hs-varid'>id</span> <span class='hs-varop'>.</span> <span class='hs-varid'>onDynamic</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-varid'>e</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-578"></a>    <span class='hs-varid'>mkDynamic</span> <span class='hs-varid'>s</span> <span class='hs-varid'>e</span>
<a name="line-579"></a>      <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-conid'>()</span> <span class='hs-keyword'>of</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&gt;</span> <span class='hs-varid'>e</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mempty</span>
<a name="line-580"></a>                          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>d</span> <span class='hs-varid'>t</span>
<a name="line-581"></a>      <span class='hs-layout'>)</span>
<a name="line-582"></a>
<a name="line-583"></a><a name="setEra"></a><span class='hs-comment'>-- | Set the era of an 'Active' value.  Note that this will change a</span>
<a name="line-584"></a><span class='hs-comment'>--   constant 'Active' into a dynamic one which happens to have the</span>
<a name="line-585"></a><span class='hs-comment'>--   same value at all times.</span>
<a name="line-586"></a><span class='hs-definition'>setEra</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Era</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-587"></a><span class='hs-definition'>setEra</span> <span class='hs-varid'>er</span> <span class='hs-keyglyph'>=</span>
<a name="line-588"></a>  <span class='hs-varid'>onActive</span>
<a name="line-589"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>mkActive</span> <span class='hs-layout'>(</span><span class='hs-varid'>start</span> <span class='hs-varid'>er</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>end</span> <span class='hs-varid'>er</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>const</span><span class='hs-layout'>)</span>
<a name="line-590"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>fromDynamic</span> <span class='hs-varop'>.</span> <span class='hs-varid'>onDynamic</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkDynamic</span> <span class='hs-layout'>(</span><span class='hs-varid'>start</span> <span class='hs-varid'>er</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>end</span> <span class='hs-varid'>er</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-591"></a>
<a name="line-592"></a><a name="atTime"></a><span class='hs-comment'>-- | @atTime t a@ is an active value with the same behavior as @a@,</span>
<a name="line-593"></a><span class='hs-comment'>--   shifted so that it starts at time @t@.  If @a@ is constant it is</span>
<a name="line-594"></a><span class='hs-comment'>--   returned unchanged.</span>
<a name="line-595"></a><span class='hs-definition'>atTime</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Time</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-596"></a><span class='hs-definition'>atTime</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>shift</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span> <span class='hs-varop'>.-.</span> <span class='hs-varid'>start</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>activeEra</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-597"></a>
<a name="line-598"></a><a name="after"></a><span class='hs-comment'>-- | @a1 \`after\` a2@ produces an active that behaves like @a1@ but is</span>
<a name="line-599"></a><span class='hs-comment'>--   shifted to start at the end time of @a2@.  If either @a1@ or @a2@</span>
<a name="line-600"></a><span class='hs-comment'>--   are constant, @a1@ is returned unchanged.</span>
<a name="line-601"></a><span class='hs-definition'>after</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-602"></a><span class='hs-definition'>after</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>a1</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>`atTime`</span> <span class='hs-varid'>a1</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>end</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>activeEra</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span>
<a name="line-603"></a>
<a name="line-604"></a><span class='hs-keyword'>infixr</span> <span class='hs-num'>5</span> <span class='hs-varop'>-&gt;&gt;</span>
<a name="line-605"></a>
<a name="line-606"></a>
<a name="line-607"></a><span class='hs-comment'>-- XXX illustrate</span>
<a name="line-608"></a>
<a name="line-609"></a><a name="-%3e%3e"></a><span class='hs-comment'>-- | Sequence/overlay two 'Active' values: shift the second to start</span>
<a name="line-610"></a><span class='hs-comment'>--   immediately after the first (using 'after'), then compose them</span>
<a name="line-611"></a><span class='hs-comment'>--   (using '&lt;&gt;').</span>
<a name="line-612"></a><span class='hs-layout'>(</span><span class='hs-varop'>-&gt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Semigroup</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-613"></a><a name="a1"></a><span class='hs-definition'>a1</span> <span class='hs-varop'>-&gt;&gt;</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a1</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a2</span> <span class='hs-varop'>`after`</span> <span class='hs-varid'>a1</span><span class='hs-layout'>)</span>
<a name="line-614"></a>
<a name="line-615"></a>
<a name="line-616"></a><span class='hs-comment'>-- XXX illustrate</span>
<a name="line-617"></a>
<a name="line-618"></a><a name="%7c%3e%3e"></a><span class='hs-comment'>-- | \"Splice\" two 'Active' values together: shift the second to</span>
<a name="line-619"></a><span class='hs-comment'>--   start immediately after the first (using 'after'), and produce</span>
<a name="line-620"></a><span class='hs-comment'>--   the value which acts like the first up to the common end/start</span>
<a name="line-621"></a><span class='hs-comment'>--   point, then like the second after that.  If both are constant,</span>
<a name="line-622"></a><span class='hs-comment'>--   return the first.</span>
<a name="line-623"></a><span class='hs-layout'>(</span><span class='hs-varop'>|&gt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-624"></a><span class='hs-definition'>a1</span> <span class='hs-varop'>|&gt;&gt;</span> <span class='hs-varid'>a2</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromJust</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getFirst</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-625"></a>            <span class='hs-layout'>(</span><span class='hs-varid'>trimAfter</span> <span class='hs-layout'>(</span><span class='hs-conid'>First</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>a1</span><span class='hs-layout'>)</span> <span class='hs-varop'>-&gt;&gt;</span> <span class='hs-varid'>trimBefore</span> <span class='hs-layout'>(</span><span class='hs-conid'>First</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>a2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-626"></a>
<a name="line-627"></a><span class='hs-comment'>-- XXX implement 'movie' with a balanced fold</span>
<a name="line-628"></a>
<a name="line-629"></a><a name="movie"></a><span class='hs-comment'>-- | Splice together a list of active values using '|&gt;&gt;'.  The list</span>
<a name="line-630"></a><span class='hs-comment'>--   must be nonempty.</span>
<a name="line-631"></a><span class='hs-definition'>movie</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Active</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-632"></a><span class='hs-definition'>movie</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr1</span> <span class='hs-layout'>(</span><span class='hs-varop'>|&gt;&gt;</span><span class='hs-layout'>)</span>
<a name="line-633"></a>
<a name="line-634"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-635"></a><span class='hs-comment'>--  Discretization</span>
<a name="line-636"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-637"></a>
<a name="line-638"></a><a name="discrete"></a><span class='hs-comment'>-- | Create an @Active@ which takes on each value in the given list in</span>
<a name="line-639"></a><span class='hs-comment'>--   turn during the time @[0,1]@, with each value getting an equal</span>
<a name="line-640"></a><span class='hs-comment'>--   amount of time.  In other words, @discrete@ creates a \"slide</span>
<a name="line-641"></a><span class='hs-comment'>--   show\" that starts at time 0 and ends at time 1.  The first</span>
<a name="line-642"></a><span class='hs-comment'>--   element is used prior to time 0, and the last element is used</span>
<a name="line-643"></a><span class='hs-comment'>--   after time 1.</span>
<a name="line-644"></a><span class='hs-comment'>--</span>
<a name="line-645"></a><span class='hs-comment'>--   It is an error to call @discrete@ on the empty list.</span>
<a name="line-646"></a><span class='hs-definition'>discrete</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span>
<a name="line-647"></a><span class='hs-definition'>discrete</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Data.Active.discrete must be called with a non-empty list."</span>
<a name="line-648"></a><span class='hs-definition'>discrete</span> <span class='hs-varid'>xs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>ui</span>
<a name="line-649"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Rational</span><span class='hs-layout'>)</span>
<a name="line-650"></a>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;=</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>unsafeHead</span> <span class='hs-varid'>v</span>
<a name="line-651"></a>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>1</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>unsafeLast</span> <span class='hs-varid'>v</span>
<a name="line-652"></a>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>unsafeIndex</span> <span class='hs-varid'>v</span> <span class='hs-varop'>$</span> <span class='hs-varid'>floor</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span> <span class='hs-varop'>*</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>length</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-653"></a>        <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varid'>xs</span>
<a name="line-654"></a>
<a name="line-655"></a><a name="simulate"></a><span class='hs-comment'>-- | @simulate r act@ simulates the 'Active' value @act@, returning a</span>
<a name="line-656"></a><span class='hs-comment'>--   list of \"snapshots\" taken at regular intervals from the start</span>
<a name="line-657"></a><span class='hs-comment'>--   time to the end time.  The interval used is determined by the</span>
<a name="line-658"></a><span class='hs-comment'>--   rate @r@, which denotes the \"frame rate\", that is, the number</span>
<a name="line-659"></a><span class='hs-comment'>--   of snapshots per unit time.</span>
<a name="line-660"></a><span class='hs-comment'>--</span>
<a name="line-661"></a><span class='hs-comment'>--   If the 'Active' value is constant (and thus has no start or end</span>
<a name="line-662"></a><span class='hs-comment'>--   times), a list of length 1 is returned, containing the constant</span>
<a name="line-663"></a><span class='hs-comment'>--   value.</span>
<a name="line-664"></a><span class='hs-definition'>simulate</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Rational</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Active</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-665"></a><span class='hs-definition'>simulate</span> <span class='hs-num'>0</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>const</span> <span class='hs-conid'>[]</span>
<a name="line-666"></a><span class='hs-definition'>simulate</span> <span class='hs-varid'>rate</span> <span class='hs-keyglyph'>=</span>
<a name="line-667"></a>  <span class='hs-varid'>onActive</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-668"></a>           <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>d</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>runDynamic</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>
<a name="line-669"></a>                      <span class='hs-layout'>(</span><span class='hs-keyword'>let</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>start</span> <span class='hs-layout'>(</span><span class='hs-varid'>era</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>
<a name="line-670"></a>                           <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>end</span>   <span class='hs-layout'>(</span><span class='hs-varid'>era</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span>
<a name="line-671"></a>                       <span class='hs-keyword'>in</span>  <span class='hs-keyglyph'>[</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-varop'>^/</span><span class='hs-varid'>rate</span> <span class='hs-keyglyph'>..</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-672"></a>                      <span class='hs-layout'>)</span>
<a name="line-673"></a>           <span class='hs-layout'>)</span>
<a name="line-674"></a>
<a name="line-675"></a><span class='hs-comment'>------------------------------------------------------------</span>
<a name="line-676"></a><span class='hs-comment'>-- Illustrations produced with diagrams-haddock</span>
<a name="line-677"></a><span class='hs-comment'>--</span>
<a name="line-678"></a><span class='hs-comment'>-- &gt; d :: Diagram B -&gt; Diagram B</span>
<a name="line-679"></a><span class='hs-comment'>-- &gt; d fun = (square 4 &lt;&gt; ends &lt;&gt; fun # lc red)</span>
<a name="line-680"></a><span class='hs-comment'>-- &gt;       # lineCap LineCapRound # lineJoin LineJoinRound</span>
<a name="line-681"></a><span class='hs-comment'>-- &gt;       # frame 1</span>
<a name="line-682"></a><span class='hs-comment'>-- &gt;   where ends = vert &lt;&gt; vert # translateX 1</span>
<a name="line-683"></a><span class='hs-comment'>-- &gt;                &lt;&gt; rect 1 4 # translateX (0.5) # opacity 0.2 # fc grey</span>
<a name="line-684"></a><span class='hs-comment'>-- &gt;         vert = vrule 4 # dashingG [0.1,0.1] 0 # lc grey</span>
<a name="line-685"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-686"></a><span class='hs-comment'>-- &gt; uiDia = d $</span>
<a name="line-687"></a><span class='hs-comment'>-- &gt;   ((-2) ^&amp; (-2)) ~~ (2 ^&amp; 2)</span>
<a name="line-688"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-689"></a><span class='hs-comment'>-- &gt; backwardsDia = d $</span>
<a name="line-690"></a><span class='hs-comment'>-- &gt;   (2 ^&amp; (-1)) ~~ ((-1) ^&amp; 2)</span>
<a name="line-691"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-692"></a><span class='hs-comment'>-- &gt; clampDia = d $</span>
<a name="line-693"></a><span class='hs-comment'>-- &gt;   [(2,0), (1,1), (1,0)]</span>
<a name="line-694"></a><span class='hs-comment'>-- &gt;   # map r2 # fromOffsets # centerX</span>
<a name="line-695"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-696"></a><span class='hs-comment'>-- &gt; clampBeforeDia = d $</span>
<a name="line-697"></a><span class='hs-comment'>-- &gt;   [(2,0), (2,2)]</span>
<a name="line-698"></a><span class='hs-comment'>-- &gt;   # map r2 # fromOffsets # centerX</span>
<a name="line-699"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-700"></a><span class='hs-comment'>-- &gt; clampAfterDia = d $</span>
<a name="line-701"></a><span class='hs-comment'>-- &gt;   [(3,3), (1,0)]</span>
<a name="line-702"></a><span class='hs-comment'>-- &gt;   # map r2 # fromOffsets # centerX # translateY (-2)</span>
<a name="line-703"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-704"></a><span class='hs-comment'>-- &gt; trimDia = d $ origin ~~ (1 ^&amp; 1)</span>
<a name="line-705"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-706"></a><span class='hs-comment'>-- &gt; trimBeforeDia = d $ origin ~~ (2 ^&amp; 2)</span>
<a name="line-707"></a><span class='hs-comment'>-- &gt;</span>
<a name="line-708"></a><span class='hs-comment'>-- &gt; trimAfterDia = d $ ((-2) ^&amp; (-2)) ~~ (1 ^&amp; 1)</span>
</pre></body>
</html>
