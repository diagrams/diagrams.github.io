<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Data/Tree/DUAL.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a>
<a name="line-2"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-3"></a><span class='hs-comment'>-- |</span>
<a name="line-4"></a><span class='hs-comment'>-- Module      :  Data.Tree.DUAL</span>
<a name="line-5"></a><span class='hs-comment'>-- Copyright   :  (c) 2011-2012 Brent Yorgey</span>
<a name="line-6"></a><span class='hs-comment'>-- License     :  BSD-style (see LICENSE)</span>
<a name="line-7"></a><span class='hs-comment'>-- Maintainer  :  diagrams-discuss@googlegroups.com</span>
<a name="line-8"></a><span class='hs-comment'>--</span>
<a name="line-9"></a><span class='hs-comment'>-- Rose (n-ary) trees with both upwards- (/i.e./ cached) and</span>
<a name="line-10"></a><span class='hs-comment'>-- downwards-traveling (/i.e./ accumulating) monoidal annotations.</span>
<a name="line-11"></a><span class='hs-comment'>-- This is used as the core data structure underlying the @diagrams@</span>
<a name="line-12"></a><span class='hs-comment'>-- framework (&lt;<a href="http://projects.haskell.org/diagrams">http://projects.haskell.org/diagrams</a>&gt;), but potentially</span>
<a name="line-13"></a><span class='hs-comment'>-- has other applications as well.</span>
<a name="line-14"></a><span class='hs-comment'>--</span>
<a name="line-15"></a><span class='hs-comment'>-- Abstractly, a DUALTree is a rose (n-ary) tree with data (of type</span>
<a name="line-16"></a><span class='hs-comment'>-- @l@) at leaves, data (of type @a@) at internal nodes, and two types</span>
<a name="line-17"></a><span class='hs-comment'>-- of monoidal annotations, one (of type @u@) travelling \"up\" the</span>
<a name="line-18"></a><span class='hs-comment'>-- tree and one (of type @d@) traveling \"down\".</span>
<a name="line-19"></a><span class='hs-comment'>--</span>
<a name="line-20"></a><span class='hs-comment'>-- Specifically, there are five types of nodes:</span>
<a name="line-21"></a><span class='hs-comment'>--</span>
<a name="line-22"></a><span class='hs-comment'>--   * Leaf nodes which contain a data value of type @l@ and an</span>
<a name="line-23"></a><span class='hs-comment'>--     annotation of type @u@.  The annotation represents information</span>
<a name="line-24"></a><span class='hs-comment'>--     about a tree that should be accumulated (/e.g./ number of</span>
<a name="line-25"></a><span class='hs-comment'>--     leaves, some sort of \"weight\", /etc./).  If you are familiar</span>
<a name="line-26"></a><span class='hs-comment'>--     with finger trees</span>
<a name="line-27"></a><span class='hs-comment'>--     (&lt;<a href="http://www.soi.city.ac.uk/~ross/papers/FingerTree.html">http://www.soi.city.ac.uk/~ross/papers/FingerTree.html</a>&gt;,</span>
<a name="line-28"></a><span class='hs-comment'>--     &lt;<a href="http://hackage.haskell.org/package/fingertree">http://hackage.haskell.org/package/fingertree</a>&gt;), it is the</span>
<a name="line-29"></a><span class='hs-comment'>--     same idea.</span>
<a name="line-30"></a><span class='hs-comment'>--</span>
<a name="line-31"></a><span class='hs-comment'>--   * There is also a special type of leaf node which contains only a</span>
<a name="line-32"></a><span class='hs-comment'>--     @u@ value, and no data. This allows cached @u@ values to be</span>
<a name="line-33"></a><span class='hs-comment'>--     \"modified\" by inserting extra annotations.</span>
<a name="line-34"></a><span class='hs-comment'>--</span>
<a name="line-35"></a><span class='hs-comment'>--   * Branch nodes, containing a list of subtrees.</span>
<a name="line-36"></a><span class='hs-comment'>--</span>
<a name="line-37"></a><span class='hs-comment'>--   * Internal nodes with a value of type @d@.  @d@ may have an</span>
<a name="line-38"></a><span class='hs-comment'>--     /action/ on @u@ (see the 'Action' type class, defined in</span>
<a name="line-39"></a><span class='hs-comment'>--     "Data.Monoid.Action" from the @monoid-extras@ package).</span>
<a name="line-40"></a><span class='hs-comment'>--     Semantically speaking, applying a @d@ annotation to a tree</span>
<a name="line-41"></a><span class='hs-comment'>--     transforms all the @u@ annotations below it by acting on them.</span>
<a name="line-42"></a><span class='hs-comment'>--     Operationally, however, since the action must be a monoid</span>
<a name="line-43"></a><span class='hs-comment'>--     homomorphism, applying a @d@ annotation can actually be done in</span>
<a name="line-44"></a><span class='hs-comment'>--     constant time.</span>
<a name="line-45"></a><span class='hs-comment'>--</span>
<a name="line-46"></a><span class='hs-comment'>--   * Internal nodes with data values of type @a@, possibly of a</span>
<a name="line-47"></a><span class='hs-comment'>--     different type than those in the leaves.  These are just \"along</span>
<a name="line-48"></a><span class='hs-comment'>--     for the ride\" and are unaffected by @u@ and @d@ annotations.</span>
<a name="line-49"></a><span class='hs-comment'>--</span>
<a name="line-50"></a><span class='hs-comment'>-- There are two critical points to note about @u@ and @d@ annotations:</span>
<a name="line-51"></a><span class='hs-comment'>--</span>
<a name="line-52"></a><span class='hs-comment'>--   * The combined @u@ annotation for an entire tree is always cached</span>
<a name="line-53"></a><span class='hs-comment'>--     at the root and available in constant (amortized) time.</span>
<a name="line-54"></a><span class='hs-comment'>--</span>
<a name="line-55"></a><span class='hs-comment'>--   * The 'mconcat' of all the @d@ annotations along the path from</span>
<a name="line-56"></a><span class='hs-comment'>--     the root to each leaf is available along with the leaf during a</span>
<a name="line-57"></a><span class='hs-comment'>--     fold operation.</span>
<a name="line-58"></a><span class='hs-comment'>--</span>
<a name="line-59"></a><span class='hs-comment'>-- A fold over a @DUALTree@ is given access to the internal and leaf</span>
<a name="line-60"></a><span class='hs-comment'>-- data, and the accumulated @d@ values at each leaf.  It is also</span>
<a name="line-61"></a><span class='hs-comment'>-- allowed to replace \"@u@-only\" leaves with a constant value.  In</span>
<a name="line-62"></a><span class='hs-comment'>-- particular, however, it is /not/ given access to any of the @u@</span>
<a name="line-63"></a><span class='hs-comment'>-- annotations, the idea being that those are used only for</span>
<a name="line-64"></a><span class='hs-comment'>-- /constructing/ trees.  It is also not given access to @d@ values as</span>
<a name="line-65"></a><span class='hs-comment'>-- they occur in the tree, only as they accumulate at leaves.  If you</span>
<a name="line-66"></a><span class='hs-comment'>-- do need access to @u@ or @d@ values, you can duplicate the values</span>
<a name="line-67"></a><span class='hs-comment'>-- you need in the internal data nodes.</span>
<a name="line-68"></a><span class='hs-comment'>--</span>
<a name="line-69"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-70"></a>
<a name="line-71"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Tree</span><span class='hs-varop'>.</span><span class='hs-conid'>DUAL</span>
<a name="line-72"></a>       <span class='hs-layout'>(</span>
<a name="line-73"></a>         <span class='hs-comment'>-- * DUAL-trees</span>
<a name="line-74"></a>         <span class='hs-conid'>DUALTree</span>
<a name="line-75"></a>
<a name="line-76"></a>         <span class='hs-comment'>-- * Constructing DUAL-trees</span>
<a name="line-77"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>empty</span><span class='hs-layout'>,</span> <span class='hs-varid'>leaf</span><span class='hs-layout'>,</span> <span class='hs-varid'>leafU</span><span class='hs-layout'>,</span> <span class='hs-varid'>annot</span><span class='hs-layout'>,</span> <span class='hs-varid'>applyD</span>
<a name="line-78"></a>
<a name="line-79"></a>         <span class='hs-comment'>-- * Modifying DUAL-trees</span>
<a name="line-80"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>applyUpre</span><span class='hs-layout'>,</span> <span class='hs-varid'>applyUpost</span>
<a name="line-81"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>mapU</span>
<a name="line-82"></a>
<a name="line-83"></a>         <span class='hs-comment'>-- * Accessors and eliminators</span>
<a name="line-84"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>getU</span><span class='hs-layout'>,</span> <span class='hs-varid'>foldDUAL</span><span class='hs-layout'>,</span> <span class='hs-varid'>flatten</span>
<a name="line-85"></a>
<a name="line-86"></a>       <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-87"></a>
<a name="line-88"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Tree</span><span class='hs-varop'>.</span><span class='hs-conid'>DUAL</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span>
</pre></body>
</html>
